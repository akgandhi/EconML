<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>Econ 712: Elements of Rmarkdown and R</title>

<meta property="description" itemprop="description" content="A look at some of the elements of style for your blog posts."/>


<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-02-28"/>
<meta property="article:created" itemprop="dateCreated" content="2021-02-28"/>
<meta name="article:author" content="Amit Gandhi"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Econ 712: Elements of Rmarkdown and R"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="A look at some of the elements of style for your blog posts."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Econ 712"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="Econ 712: Elements of Rmarkdown and R"/>
<meta property="twitter:description" content="A look at some of the elements of style for your blog posts."/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","css","params","preview","categories"]}},"value":[{"type":"character","attributes":{},"value":["Elements of Rmarkdown and R"]},{"type":"character","attributes":{},"value":["A look at some of the elements of style for your blog posts."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Amit Gandhi"]}]}]},{"type":"character","attributes":{},"value":["02-28-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["styles.css"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["year"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["value"]}},"value":[{"type":"integer","attributes":{},"value":[80]}]}]},{"type":"character","attributes":{},"value":["https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/rmarkdown.png"]},{"type":"character","attributes":{},"value":["lecture"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["elements-of-distill-and-rmarkdown_files/anchor-4.2.2/anchor.min.js","elements-of-distill-and-rmarkdown_files/bowser-1.9.3/bowser.min.js","elements-of-distill-and-rmarkdown_files/distill-2.2.21/template.v2.js","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-32-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-33-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-34-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-35-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-36-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-37-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-38-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-51-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-52-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-53-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-54-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-59-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-60-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-63-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-64-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-65-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-66-1.png","elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-67-1.png","elements-of-distill-and-rmarkdown_files/header-attrs-2.5/header-attrs.js","elements-of-distill-and-rmarkdown_files/header-attrs-2.7/header-attrs.js","elements-of-distill-and-rmarkdown_files/jquery-1.11.3/jquery.min.js","elements-of-distill-and-rmarkdown_files/webcomponents-2.0.0/webcomponents.js","food_prices.csv","food.csv","styles.css"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.7/header-attrs.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="styles.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Elements of Rmarkdown and R","description":"A look at some of the elements of style for your blog posts.","authors":[{"author":"Amit Gandhi","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-02-28T00:00:00.000+00:00","citationText":"Gandhi, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<span class="logo">
<img src="../../images/pennlogo.png"/>
</span>
<a href="../../index.html" class="title">Econ 712</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../about.html">About</a>
<a href="https://twitter.com/AmitEcon">
<i class="fa fa-twitter" aria-hidden="true"></i>
</a>
<a href="mailto:akgandhi@upenn.edu">
<i class="fa fa-envelope" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Elements of Rmarkdown and R</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../index.html#category:lecture" class="dt-tag">lecture</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>A look at some of the elements of style for your blog posts.</p></p>
</div>

<div class="d-byline">
  Amit Gandhi  
  
<br/>02-28-2021
</div>

<div class="d-article">
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Topics:</p>
<ul>
<li>bibliography (Jonathan)</li>
<li>Footnotes</li>
<li>Asides</li>
<li>Headers and levels</li>
<li>markdown tables</li>
<li>rendering R tables</li>
<li>inserting images, hyperlinks, boldface lettering, etc.</li>
<li>understanding the structure of YAML metadata</li>
<li>code chunk options</li>
</ul>
<h2 id="what-is-yaml">What is YAML?</h2>
<p>The initial portion of your Rmarkdown document, fenced in between the 3 dashes <code>---</code> on the top and bottom, a represents the <em>YAML metadata</em> or <em>YAML frontmatter</em> of the document. It is named according to the fact the top section of the document is written in the YAML language syntax - YAML is an recursive acronym that stands for <em>YAML aint markup language</em>.</p>
<p>The metadata defined by the code defines properties of the document that control aspects of its content, appearance, and formatting. Much of the ability to extend and customize the functionality of an Rmarkdown document arises from a suitable specification of the YAML metadata, and hence it is worth some investment of effort to learn the fundamentals.</p>
<p>The general <a href="https://yaml.org/">language guide</a> is a useful reference, and the connection between R and YAML is best appreciated from the <a href="https://cran.r-project.org/web/packages/ymlthis/vignettes/yaml-overview.html">vignette</a> associated with the <code>ymlthis</code> package.</p>
<p>The basic idea of YAML is to collect as data a set of key value pairs <code>key: value</code>, e.g.,</p>
<pre><code>---
author: Amit Gandhi
---</code></pre>
<p>The structure of metadata is isomorphic to a named list in R. In particular we can convert from a list to a YAML specification.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>metaDat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>author <span class='op'>=</span> <span class='st'>"Amit Gandhi"</span><span class='op'>)</span>
<span class='fu'>yml</span><span class='op'>(</span><span class='va'>metaDat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>---
author: Amit Gandhi
date: &#39;`r format(Sys.Date())`&#39;
---</code></pre>
<div class="sourceCode">
<pre><code><span class='fu'>draw_yml_tree</span><span class='op'>(</span><span class='va'>metaDat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> author: Amit Gandhi</code></pre>
</div>
<p>Or vice-versa, the metadata of a document can be retreived as a named list in R</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>docDat</span> <span class='op'>&lt;-</span> <span class='fu'>rmarkdown</span><span class='fu'>::</span><span class='va'><a href='https://pkgs.rstudio.com/rmarkdown/reference/metadata.html'>metadata</a></span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>docDat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>List of 9
 $ title      : chr &quot;Elements of Rmarkdown and R&quot;
 $ description: chr &quot;A look at some of the elements of style for your blog posts.\n&quot;
 $ author     :List of 1
  ..$ :List of 1
  .. ..$ name: chr &quot;Amit Gandhi&quot;
 $ date       : chr &quot;02-28-2021&quot;
 $ output     :List of 1
  ..$ distill::distill_article:List of 1
  .. ..$ self_contained: logi FALSE
 $ css        : chr &quot;styles.css&quot;
 $ params     :List of 1
  ..$ year:List of 1
  .. ..$ value: int 80
 $ preview    : chr &quot;https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/rmarkdown.png&quot;
 $ categories : chr &quot;lecture&quot;</code></pre>
</div>
<p>The other key idea is that of nesting - a field in the YAML frontmatter can have other key-value pairs as its value. The nesting is indicated by an indented space</p>
<pre><code>---
author: Amit Gandhi
output: distill::article:
          self_contained: true

---          </code></pre>
<p>The analogous data structure in R is a nested list</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>metaDat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>author <span class='op'>=</span> <span class='st'>"Amit Gandhi"</span>, output <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>`distill::article` <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>self_contained <span class='op'>=</span> <span class='st'>"TRUE"</span> <span class='op'>)</span> <span class='op'>)</span> <span class='op'>)</span>
<span class='fu'>yml</span><span class='op'>(</span><span class='va'>metaDat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>---
author: Amit Gandhi
output:
  distill::article:
    self_contained: &#39;TRUE&#39;
date: &#39;`r format(Sys.Date())`&#39;
---</code></pre>
</div>
<p>The hierarchical structure can be visualized as</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'>draw_yml_tree</span><span class='op'>(</span><span class='va'>metaDat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> author: Amit Gandhi
 output:
     distill::article:
         self_contained: &#39;TRUE&#39;</code></pre>
</div>
<p>To understand the functionality the YAML nested syntax is achieving, observe that the value of the field <code>outpt</code> in the frontmatter indicates the function used to render the Rmarkdown file. The function in this case is <code>distill::article</code>. If we examine the options to this function, we can see many potential arguments.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'>help_console</span><span class='op'>(</span><span class='st'>"distill_article"</span>, <span class='st'>"distill"</span>, format <span class='op'>=</span> <span class='st'>"html"</span><span class='op'>)</span>
</code></pre>
</div>
<table width="100%" summary="page for distill_article">
<tr>
<td>
distill_article
</td>
<td style="text-align: right;">
R Documentation
</td>
</tr>
</table>
<h2>
R Markdown format for Distill articles
</h2>
<h3>
Description
</h3>
<p>
Scientific and technical writing, native to the web.
</p>
<h3>
Usage
</h3>
<pre>
distill_article(
  toc = FALSE,
  toc_depth = 3,
  toc_float = TRUE,
  fig_width = 6.5,
  fig_height = 4,
  fig_retina = 2,
  fig_caption = TRUE,
  dev = "png",
  smart = TRUE,
  self_contained = TRUE,
  highlight = "default",
  highlight_downlit = TRUE,
  mathjax = "default",
  extra_dependencies = NULL,
  theme = NULL,
  css = NULL,
  includes = NULL,
  keep_md = FALSE,
  lib_dir = NULL,
  md_extensions = NULL,
  pandoc_args = NULL,
  ...
)
</pre>
<h3>
Arguments
</h3>
<table summary="R argblock">
<tr valign="top">
<td>
<code>toc</code>
</td>
<td>
<p>
<code>TRUE</code> to include a table of contents in the output
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>toc_depth</code>
</td>
<td>
<p>
Depth of headers to include in table of contents
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>toc_float</code>
</td>
<td>
<p>
Float the table of contents to the left when the article is displayed at widths &gt; 1000px. If set to <code>FALSE</code> or the width is less than 1000px the table of contents will be placed above the article body.
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>fig_width</code>
</td>
<td>
<p>
Default width (in inches) for figures
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>fig_height</code>
</td>
<td>
<p>
Default height (in inches) for figures
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>fig_retina</code>
</td>
<td>
<p>
Scaling to perform for retina displays (defaults to 2, which currently works for all widely used retina displays). Set to <code>NULL</code> to prevent retina scaling. Note that this will always be <code>NULL</code> when <code>keep_md</code> is specified (this is because <code>fig_retina</code> relies on outputting HTML directly into the markdown document).
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>fig_caption</code>
</td>
<td>
<p>
<code>TRUE</code> to render figures with captions
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>dev</code>
</td>
<td>
<p>
Graphics device to use for figure output (defaults to png)
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>smart</code>
</td>
<td>
<p>
Produce typographically correct output, converting straight quotes to curly quotes, <code style="white-space: pre;"></code> to em-dashes, <code style="white-space: pre;"></code> to en-dashes, and <code></code> to ellipses.
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>self_contained</code>
</td>
<td>
<p>
Produce a standalone HTML file with no external dependencies, using data: URIs to incorporate the contents of linked scripts, stylesheets, images, and videos. Note that even for self contained documents MathJax is still loaded externally (this is necessary because of its size).
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>highlight</code>
</td>
<td>
<p>
Syntax highlighting style. Supported styles include default, rstudio, tango, pygments, kate, monochrome, espresso, zenburn, breezedark, and haddock. Pass NULL to prevent syntax highlighting.
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>highlight_downlit</code>
</td>
<td>
<p>
Use the <span class="pkg">downlit</span> package to highlight R code (including providing hyperlinks to function documentation).
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>mathjax</code>
</td>
<td>
<p>
Include mathjax. The default option uses an https URL from a MathJax CDN. The local option uses a local version of MathJax (which is copied into the output directory). You can pass an alternate URL or pass <code>NULL</code> to exclude MathJax entirely.
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>extra_dependencies</code>
</td>
<td>
<p>
Additional function arguments to pass to the base R Markdown HTML output formatter <code>html_document_base</code>
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>theme</code>
</td>
<td>
<p>
CSS file with theme variable definitions
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>css</code>
</td>
<td>
<p>
One or more css files to include
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>includes</code>
</td>
<td>
<p>
Named list of additional content to include within the document (typically created using the <code>includes</code> function).
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>keep_md</code>
</td>
<td>
<p>
Keep the markdown file generated by knitting.
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>lib_dir</code>
</td>
<td>
<p>
Directory to copy dependent HTML libraries (e.g.jquery, bootstrap, etc.) into. By default this will be the name of the document with <code>_files</code> appended to it.
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>md_extensions</code>
</td>
<td>
<p>
Markdown extensions to be added or removed from the default definition or R Markdown. See the <code>rmarkdown_format</code> for additional details.
</p>
</td>
</tr>
<tr valign="top">
<td>
<code>pandoc_args</code>
</td>
<td>
<p>
Additional command line options to pass to pandoc
</p>
</td>
</tr>
<tr valign="top">
<td>
<code></code>
</td>
<td>
<p>
Additional function arguments to pass to the base R Markdown HTML output formatter <code>html_document_base</code>
</p>
</td>
</tr>
</table>
<h3>
Details
</h3>
<p>
Distill articles feature attractive, reader-friendly typography, flexible layout options for visualizations, and full support for footnotes and citations.
</p>
</div>
<p>We can see many options associated with the function. If we want to use the default values we can simply associate the value <code>default</code> with the field <code>distill::article</code>.</p>
<pre><code>---
&lt;yaml&gt;
output:
  distill::distill_article: default
&lt;yaml&gt;
---</code></pre>
<p>But if we wish to set any of the arguments, we must engage another nest of key value pairs, e.g.,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>metaDat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>author <span class='op'>=</span> <span class='st'>"Amit Gandhi"</span>, output <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>`distill::article` <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>self_contained <span class='op'>=</span> <span class='st'>"TRUE"</span>, toc <span class='op'>=</span> <span class='st'>"TRUE"</span> <span class='op'>)</span> <span class='op'>)</span> <span class='op'>)</span>
<span class='fu'>yml</span><span class='op'>(</span><span class='va'>metaDat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>---
author: Amit Gandhi
output:
  distill::article:
    self_contained: &#39;TRUE&#39;
    toc: &#39;TRUE&#39;
date: &#39;`r format(Sys.Date())`&#39;
---</code></pre>
<div class="sourceCode">
<pre><code><span class='fu'>draw_yml_tree</span><span class='op'>(</span><span class='va'>metaDat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> author: Amit Gandhi
 output:
     distill::article:
         self_contained: &#39;TRUE&#39;
         toc: &#39;TRUE&#39;</code></pre>
</div>
<p>Instead of nested data capturing key-value pairs (which are named lists), the value of a field if its more complex than a simple value can be an unnamed vector, such as</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>metaDat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>author <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Amit Gandhi"</span>, <span class='st'>"coauthor"</span><span class='op'>)</span>, output <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>`distill::article` <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>self_contained <span class='op'>=</span> <span class='st'>"TRUE"</span>, toc <span class='op'>=</span> <span class='st'>"TRUE"</span> <span class='op'>)</span> <span class='op'>)</span> <span class='op'>)</span>
<span class='fu'>yml</span><span class='op'>(</span><span class='va'>metaDat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>---
author:
- Amit Gandhi
- coauthor
output:
  distill::article:
    self_contained: &#39;TRUE&#39;
    toc: &#39;TRUE&#39;
date: &#39;`r format(Sys.Date())`&#39;
---</code></pre>
</div>
<p>Observe this is captured in YAML code as</p>
<pre><code>---
author:
- A
- B
- C
---</code></pre>
<p>where each element of the vector is entered with a new line along with a <code>-</code> without a need for indentation.</p>
<p>A slight elaboration of this pattern is grouped data, as arises with the <code>params</code> field in the frontmatter</p>
<pre><code>---
params:
- a: 1.0
  input: numeric
- data: data.csv
  input: text
---</code></pre>
<p>which is useful to group related data. The corresponding R data structure is an unnamed list, e.g.,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>params <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>a <span class='op'>=</span> <span class='fl'>1.0</span>, input <span class='op'>=</span> <span class='st'>"numeric"</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='st'>"data.csv"</span>, input <span class='op'>=</span> <span class='st'>"text"</span><span class='op'>)</span> <span class='op'>)</span> <span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>yml</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>---
params:
- a: 1.0
  input: numeric
- data: data.csv
  input: text
author: Amit Gandhi
date: &#39;`r format(Sys.Date())`&#39;
---</code></pre>
</div>
<p>There are a few differences with R and YAML that should be recognized from our exercise. The first is that string values do not have to be quoted, unless they contain special characters, e.g.,</p>
<pre><code>---
title: &#39;R Markdown: An Introduction&#39;
---</code></pre>
<p>The string value is quoted because of the presence of the special character (a colon).</p>
<p>Also observe that whereas the logical values in R are TRUE/FALSE, in YAML they can be yes/no, true/false, or on/off.</p>
<h2 id="on-the-usefulness-of-parameterized-documents">On the usefulness of parameterized documents</h2>
<p>THe parameter field in the YAML front matter as it allows for the creation of parameterized reports. Such report generation is especially powerful when used in conjunction with the <code>glue</code> and <code>epoxy</code> packages, which we explore below.</p>
<p>Lets use the BLP data (borrowing from Jonathan and Shengs project.)</p>
<p>First import the data</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>carDat</span> <span class='op'>=</span> <span class='fu'>read_csv</span><span class='op'>(</span><span class='st'>"../jonathan-sheng-algorithmic-demand-estimation/blp.csv"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Lets use a dplyr verb to count the number of observations by model_year</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>carDat</span> <span class='op'>%&gt;%</span>
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>model_year</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 20 x 2
   model_year     n
 *      &lt;dbl&gt; &lt;int&gt;
 1         71   131
 2         72   193
 3         73    69
 4         74    81
 5         75   131
 6         76    88
 7         77   101
 8         78    91
 9         79    90
10         80   125
11         81   130
12         82    88
13         83    95
14         84   211
15         85   122
16         86    97
17         87   120
18         88   101
19         89    87
20         90    66</code></pre>
</div>
<p>Contrast it with the so called <code>market</code> variable</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>carDat</span> <span class='op'>%&gt;%</span>
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>market</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 20 x 2
   market     n
 *  &lt;dbl&gt; &lt;int&gt;
 1      1    92
 2      2    89
 3      3    86
 4      4    72
 5      5    93
 6      6    99
 7      7    95
 8      8    95
 9      9   102
10     10   103
11     11   116
12     12   110
13     13   115
14     14   113
15     15   136
16     16   130
17     17   143
18     18   150
19     19   147
20     20   131</code></pre>
</div>
<p>We can use the <a href="https://glue.tidyverse.org/index.html">glue</a> package to weave the data together with text. Effectively we can Lets foreshadow the application.</p>
The simplest application of glue is
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>a</span> <span class='op'>&lt;-</span> <span class='st'>"Amit"</span>
<span class='fu'>glue</span><span class='op'>(</span><span class='st'>"My name is {a}"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>My name is Amit</code></pre>
</div>
<p>we can paste together distinct strings</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>a</span> <span class='op'>&lt;-</span> <span class='st'>"Amit"</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fl'>712</span>
<span class='fu'>glue</span><span class='op'>(</span><span class='st'>"My name is {a}"</span>, <span class='st'>"I teach Econ {b}"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>My name is AmitI teach Econ 712</code></pre>
</div>
<p>It is useful to add a separator</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>a</span> <span class='op'>&lt;-</span> <span class='st'>"Amit"</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fl'>712</span>
<span class='fu'>glue</span><span class='op'>(</span><span class='st'>"My name is {a}"</span>, <span class='st'>"I teach Econ {b}"</span>, .sep <span class='op'>=</span> <span class='st'>", "</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>My name is Amit, I teach Econ 712</code></pre>
</div>
<p>The function naturally vectorizes</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Amit"</span>, <span class='st'>"Amit"</span><span class='op'>)</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>712</span>, <span class='fl'>712</span><span class='op'>)</span>
<span class='fu'>glue</span><span class='op'>(</span><span class='st'>"My name is {a}"</span>, <span class='st'>"I teach Econ {b}"</span>, .sep <span class='op'>=</span> <span class='st'>", "</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code>My name is Amit, I teach Econ 712
My name is Amit, I teach Econ 712</code></pre>
</div>
<p>which is a character vector of length 2</p>
<p>If we want to collapse the vector into text that can be rendered in markdown we must use the <code>results = asis</code> chunk option and collapse the resulting vector.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'>glue</span><span class='op'>(</span><span class='st'>"My name is {a}"</span>, <span class='st'>"I teach Econ {b}"</span>, .sep <span class='op'>=</span> <span class='st'>", "</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>glue_collapse</span><span class='op'>(</span><span class='st'>"\n"</span><span class='op'>)</span>
</code></pre>
</div>
<p>My name is Amit, I teach Econ 712 My name is Amit, I teach Econ 712</p>
</div>
<p>If we want to use data masking and reference variables directly we can via <code>glue_data()</code></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>demoDat</span> <span class='op'>&lt;-</span> <span class='fu'>tribble</span><span class='op'>(</span>
  <span class='op'>~</span><span class='va'>name</span>, <span class='op'>~</span><span class='va'>course</span>,
  <span class='st'>"Amit"</span>, <span class='fl'>712</span>,
  <span class='st'>"Amit"</span>, <span class='fl'>712</span>
<span class='op'>)</span>

<span class='va'>demoDat</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>glue_data</span><span class='op'>(</span><span class='st'>"My name is {name}, and I teach Econ {course}"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>My name is Amit, and I teach Econ 712
My name is Amit, and I teach Econ 712</code></pre>
</div>
<p>We can use the <code>epoxy</code> package to seamlessly blend text and code with a new engine for <code>knitr</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<ul>
<li>My name is Amit and the course I teach is Econ 712</li>
<li>My name is Amit and the course I teach is Econ 712</li>
</ul>
</div>
<p>The combination of <code>epoxy</code> and <code>glue</code> are powerful when connected to parameter meta data. We can thus write</p>
<div class="layout-chunk" data-layout="l-body">
<ul>
<li>In the year <strong>1971</strong> there were <em>131</em> car models.</li>
<li>In the year <strong>1972</strong> there were <em>193</em> car models.</li>
<li>In the year <strong>1973</strong> there were <em>69</em> car models.</li>
<li>In the year <strong>1974</strong> there were <em>81</em> car models.</li>
<li>In the year <strong>1975</strong> there were <em>131</em> car models.</li>
<li>In the year <strong>1976</strong> there were <em>88</em> car models.</li>
<li>In the year <strong>1977</strong> there were <em>101</em> car models.</li>
<li>In the year <strong>1978</strong> there were <em>91</em> car models.</li>
<li>In the year <strong>1979</strong> there were <em>90</em> car models.</li>
<li>In the year <strong>1980</strong> there were <em>125</em> car models.</li>
<li>In the year <strong>1981</strong> there were <em>130</em> car models.</li>
<li>In the year <strong>1982</strong> there were <em>88</em> car models.</li>
<li>In the year <strong>1983</strong> there were <em>95</em> car models.</li>
<li>In the year <strong>1984</strong> there were <em>211</em> car models.</li>
<li>In the year <strong>1985</strong> there were <em>122</em> car models.</li>
<li>In the year <strong>1986</strong> there were <em>97</em> car models.</li>
<li>In the year <strong>1987</strong> there were <em>120</em> car models.</li>
<li>In the year <strong>1988</strong> there were <em>101</em> car models.</li>
<li>In the year <strong>1989</strong> there were <em>87</em> car models.</li>
<li>In the year <strong>1990</strong> there were <em>66</em> car models.</li>
</ul>
</div>
<h2 id="building-yaml-objects-from-a-pipeline">Building YAML objects from a pipeline</h2>
<p>One of the powerful features of the Tidyverse is its natural ability to express data pipelines.</p>
<p>I look at data pipelines rather broadly as the encapsulation of most computations.</p>
<p>It is helpful to recall/recognize the two fundamental rules of R:</p>
<ol type="1">
<li>Everything that exists in R is an object</li>
<li>Everything that happens in R is a function call</li>
</ol>
<p>Thus a natural way to builld or develop a thought process is to start with a simple object and layer complexity by transforming the object via function calls.</p>
<p>Objects in R are data structures. The interpretation of the data structure is given by the <code>class()</code> of the object. Applying a function to an object to yield another object can thus be seen as a manipulation of a data structure. In this fashion, general programming in R becomes a form of data analysis!</p>
<p>An important construct to aid this form of analysis is the pipe operator <code>%&gt;%</code>. It passes an object into a function (in its first argument) and the object resulting from the function call can be passed to another function, and so on, resulting in a data pipeline!</p>
<p>Lets examine this process with the <code>ymlthis</code> package. We have already seen that YAML metadata maps to an R data structure (effectively a named list with nested lists/vectors).</p>
<p>How can we conceptually develop the data. Lets start with the creation of a <code>yml</code> object</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>ymlDat</span> <span class='op'>&lt;-</span>
  <span class='fu'>yml</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Observe the class and underlying base type.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>ymlDat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;yml&quot;</code></pre>
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/base/typeof.html'>typeof</a></span><span class='op'>(</span><span class='va'>ymlDat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;list&quot;</code></pre>
</div>
<p>We can see the data structure named <code>ymlDat</code> is of class yml which is underneath the hood a list of data that can be interpreted as YAML metadata by appropriate functions. In particular functions that start with <code>yml_*()</code> take and return <code>yml</code> objects,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'>yml</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>yml_title</span><span class='op'>(</span><span class='st'>"Economics and ML"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>yml_output</span><span class='op'>(</span><span class='fu'>rmarkdown</span><span class='fu'>::</span><span class='fu'><a href='https://pkgs.rstudio.com/rmarkdown/reference/html_document.html'>html_document</a></span><span class='op'>(</span>toc <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>---
author: Amit Gandhi
date: &#39;`r format(Sys.Date())`&#39;
title: Economics and ML
output:
  rmarkdown::html_document:
    toc: true
---</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'>yml_empty</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>yml_author</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Amit GAndhi"</span>, <span class='st'>"coauthor"</span><span class='op'>)</span>, affiliation <span class='op'>=</span> <span class='st'>"University of Pennsylvania"</span>, url <span class='op'>=</span> <span class='st'>"www.upenn.edu"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>yml_title</span><span class='op'>(</span><span class='st'>"A discussion of Rmarkdown"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>yml_description</span><span class='op'>(</span><span class='st'>"A deeper look into pipelines"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>yml_distill_opts</span><span class='op'>(</span>
    twitter_site <span class='op'>=</span> <span class='st'>"xxx"</span>,
    collection <span class='op'>=</span> <span class='fu'>distill_collection</span><span class='op'>(</span>
      share <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"twitter"</span>, <span class='st'>"linkedin"</span><span class='op'>)</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code>---
author:
- name: Amit GAndhi
  affiliation: University of Pennsylvania
  url: www.upenn.edu
- name: coauthor
  affiliation: University of Pennsylvania
  url: www.upenn.edu
title: A discussion of Rmarkdown
description: A deeper look into pipelines
collection:
  post:
    share:
    - twitter
    - linkedin
twitter:
  site: xxx
---</code></pre>
</div>
<p>We can add parameters</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'>yml</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>yml_params</span><span class='op'>(</span>country <span class='op'>=</span> <span class='st'>"Turkey"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>---
author: Amit Gandhi
date: &#39;`r format(Sys.Date())`&#39;
params:
  country: Turkey
---</code></pre>
</div>
<p>We can also add a bibliography</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'>yml</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>yml_citations</span><span class='op'>(</span>bibliography <span class='op'>=</span> <span class='st'>"refs.bib"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>---
author: Amit Gandhi
date: &#39;`r format(Sys.Date())`&#39;
bibliography: refs.bib
---</code></pre>
</div>
<p>We can instead add references manually instead of throught a .bib file</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>ref</span> <span class='op'>&lt;-</span> <span class='fu'>reference</span><span class='op'>(</span>
  id <span class='op'>=</span> <span class='st'>"fenner2012a"</span>,
  title <span class='op'>=</span> <span class='st'>"One-click science marketing"</span>,
  author <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    family <span class='op'>=</span> <span class='st'>"Fenner"</span>,
    given <span class='op'>=</span> <span class='st'>"Martin"</span>
  <span class='op'>)</span>,
  `container-title` <span class='op'>=</span> <span class='st'>"Nature Materials"</span>,
  volume <span class='op'>=</span> <span class='fl'>11L</span>,
  URL <span class='op'>=</span> <span class='st'>"https://doi.org/10.1038/nmat3283"</span>,
  DOI <span class='op'>=</span> <span class='st'>"10.1038/nmat3283"</span>,
  issue <span class='op'>=</span> <span class='fl'>4L</span>,
  publisher <span class='op'>=</span> <span class='st'>"Nature Publishing Group"</span>,
  page <span class='op'>=</span> <span class='st'>"261-263"</span>,
  type <span class='op'>=</span> <span class='st'>"article-journal"</span>,
  issued <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    year <span class='op'>=</span> <span class='fl'>2012</span>,
    month <span class='op'>=</span> <span class='fl'>3</span>
  <span class='op'>)</span>
<span class='op'>)</span>

<span class='fu'>yml</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>yml_reference</span><span class='op'>(</span><span class='va'>ref</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>---
author: Amit Gandhi
date: &#39;`r format(Sys.Date())`&#39;
reference:
- id: fenner2012a
  title: One-click science marketing
  author:
    family: Fenner
    given: Martin
  container-title: Nature Materials
  volume: 11
  URL: https://doi.org/10.1038/nmat3283
  DOI: 10.1038/nmat3283
  issue: 4
  publisher: Nature Publishing Group
  page: 261-263
  type: article-journal
  issued:
    year: 2012.0
    month: 3.0
---</code></pre>
</div>
<p>We can then reference the entry using <code>@id</code> in Rmarkdown.</p>
<p>Finally we can create the markdown text that produces the YAML frontmatter via</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb30"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> Amit Gandhi</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;`r format(Sys.Date())`&#39;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code></pre></div>
</div>
<h2 id="data-frame-pipelines">Data Frame pipelines</h2>
<p>Lets imitate the workflow, but for a data set. A tibble is a class of an object. We act on the tibble with verbs. The major verbs are given by the <code>dplyr</code> package.</p>
<h3 id="verbs">Verbs</h3>
<p>We are going to cover a set of functions that take a data frame as an input and return a new version of the data frame.</p>
<p>These functions are called <em>verbs</em> and come from the <strong>dplyr</strong> package. If you are familiar with running database queries, note that all of these verbs map onto SQL commands. In fact, R can be set up so that <strong>dplyr</strong> is called over a database rather than a local data frame in memory.</p>
<p>There are over 40 verbs in the <strong>dplyr</strong> package, though most are a minor variant or specific application of another verb. We start with four of them, all of which are related to selecting and arranging rows and columns:</p>
<ul>
<li>select a subset of rows from the original data set (<code>filter</code>)</li>
<li>select a subset of columns from the original data set (<code>select</code>)</li>
<li>sort the rows of a data set (<code>arrange</code>)</li>
</ul>
<p>In all verb functions, the first argument is the original data frame and the output is a new data frame. Here, we will also see the functions <code>between</code> and <code>%in%</code> to assist with the filtering command and <code>desc</code> to assist with arranging the rows of a data set.</p>
<p>Note that <strong>verbs do not modify the original data</strong>; they operate on a copy of the original data. We have to make an explicit name for the new data set if we want to save it for use elsewhere.</p>
<h3 id="choosing-rows">Choosing rows</h3>
<p>It is often useful to take a subset of the rows of an existing data set, for example if you want to build a model on a certain subpopulation or highlight a particular part of the data in a plot.</p>
<p>A standard way to take a subset of our data is to select rows based on conditions about the variables in the data set. To do this we use the <code>filter</code> function, which accepts a statement about variable in the data set. Only rows where the statements are true will be returned. For example, here is how we use the <code>filter</code> command to select the foods that have more than 150 calories grams of sugar in each serving:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>calories</span> <span class='op'>&gt;</span> <span class='fl'>150</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 20 x 17
   item       food_group calories total_fat sat_fat cholesterol sodium
   &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;
 1 Avocado    fruit           160      14.6   2.13            0      7
 2 Chickpea   grains          180       2.9   0.309           0    243
 3 Beef       meat            288      19.5   7.73           87    384
 4 Catfish    fish            240      14.5   3.25           69    398
 5 Cheese     dairy           350      26.9  16.6            83    955
 6 Chicken    meat            237      13.4   3.76           87    404
 7 Clam       fish            180       8     1.60           56    400
 8 Cod        fish            211      10.8   2.22           57    401
 9 Halibut    fish            239      17.7   3.10           59    103
10 Lamb       meat            292      20.7   8.76           96    394
11 Oat        grains          389       6     1.22            0      2
12 Oyster     fish            160       7.9   1.85           57    595
13 Penne      grains          157       0.9   0.175           0    233
14 Pork       meat            271      17     6.17           90    384
15 Salmon     fish            171       7.5   1.31           62    467
16 Scallop    fish            217      10.9   2.22           54    487
17 Sour Cream dairy           214      20.9  13.0            44     53
18 Swordfish  fish            177       8.2   1.96           47    494
19 Tuna       fish            153       3.9   0.811          53    366
20 Turkey     meat            187       7     2.00           77     69
#  with 10 more variables: carbs &lt;dbl&gt;, fiber &lt;dbl&gt;, sugar &lt;dbl&gt;,
#   protein &lt;dbl&gt;, iron &lt;dbl&gt;, vitamin_a &lt;dbl&gt;, vitamin_c &lt;dbl&gt;,
#   wiki &lt;chr&gt;, description &lt;chr&gt;, color &lt;chr&gt;</code></pre>
</div>
<p>The output data set has only 20 rows, compared to the 62 in the original data. Other comparisons can be done with <code>&lt;</code>, <code>&gt;=</code> and <code>&lt;=</code>. There is also a special function called <code>between</code> that is often useful. For example, here are the rows that have between 2 and 3 grams of total fat:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>between</span><span class='op'>(</span><span class='va'>total_fat</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 4 x 17
  item  food_group calories total_fat sat_fat cholesterol sodium carbs
  &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 Chic grains          180       2.9   0.309           0    243 30.0 
2 Quin grains          143       2.2   0.226           0    196 26.4 
3 Shri fish            144       2.3   0.446         206    613  1.24
4 Pota vegetable       104       2     0.458           0    254 19.4 
#  with 9 more variables: fiber &lt;dbl&gt;, sugar &lt;dbl&gt;, protein &lt;dbl&gt;,
#   iron &lt;dbl&gt;, vitamin_a &lt;dbl&gt;, vitamin_c &lt;dbl&gt;, wiki &lt;chr&gt;,
#   description &lt;chr&gt;, color &lt;chr&gt;</code></pre>
</div>
<p>If you want to filter on a categorical variable, you can use the <code>%in%</code> operator to select specific categories. Here is the code to filter only the fish and vegetable variables:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>food_group</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"fish"</span>, <span class='st'>"vegetable"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 30 x 17
   item       food_group calories total_fat sat_fat cholesterol sodium
   &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;
 1 Asparagus  vegetable        20       0.1   0.046           0      2
 2 String Be vegetable        31       0.1   0.026           0      6
 3 Bell Pepp vegetable        26       0     0.059           0      2
 4 Crab       fish             87       1     0.222          78    293
 5 Broccoli   vegetable        34       0.3   0.039           0     33
 6 Cabbage    vegetable        24       0.1   0.016           0     18
 7 Carrot     vegetable        41       0.2   0.037           0     69
 8 Catfish    fish            240      14.5   3.25           69    398
 9 Cauliflow vegetable        25       0     0.032           0     30
10 Celery     vegetable        14       0.1   0.043           0     80
#  with 20 more rows, and 10 more variables: carbs &lt;dbl&gt;,
#   fiber &lt;dbl&gt;, sugar &lt;dbl&gt;, protein &lt;dbl&gt;, iron &lt;dbl&gt;,
#   vitamin_a &lt;dbl&gt;, vitamin_c &lt;dbl&gt;, wiki &lt;chr&gt;, description &lt;chr&gt;,
#   color &lt;chr&gt;</code></pre>
</div>
<p>As with the other verbs, we can chain together multiple calls to produce more complex logic. For example, this code selects fruits that have more than 150 calories per serving:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>calories</span> <span class='op'>&gt;</span> <span class='fl'>150</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>food_group</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"fruit"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 17
  item  food_group calories total_fat sat_fat cholesterol sodium carbs
  &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 Avoc fruit           160      14.6    2.13           0      7  8.53
#  with 9 more variables: fiber &lt;dbl&gt;, sugar &lt;dbl&gt;, protein &lt;dbl&gt;,
#   iron &lt;dbl&gt;, vitamin_a &lt;dbl&gt;, vitamin_c &lt;dbl&gt;, wiki &lt;chr&gt;,
#   description &lt;chr&gt;, color &lt;chr&gt;</code></pre>
</div>
<p>Which results in a reduced data set with only 1 row (avocados). You can also use <code>==</code> to test equality (<code>food_group == "fruit"</code>) or <code>!=</code> to test whether a variable is <em>not</em> equal to a specific value.</p>
<p>It is also possible to create a chain of calls that then get piped into a call to the <code>ggplot</code> function.</p>
<p>For example, here is a plot of the fruits and vegetables with the Avocado outlier removed (by limiting the maximum available total fat).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>food_group</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"vegetable"</span>, <span class='st'>"fruit"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>total_fat</span> <span class='op'>&lt;</span> <span class='fl'>10</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>calories</span>, y <span class='op'>=</span> <span class='va'>total_fat</span>, color <span class='op'>=</span> <span class='va'>food_group</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>calories</span>, y <span class='op'>=</span> <span class='va'>total_fat</span>, label <span class='op'>=</span> <span class='va'>item</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>scale_color_viridis_d</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-33-1.png" width="624" /></p>
</div>
<p>The pattern of a starting with a data set, applying a number of transformations, and then creating a visualization of the data will become a common pattern.</p>
<h3 id="data-and-layers">Data and Layers</h3>
<p>Now that we know how to create a subset of our data, lets use this new knowledge to build some interesting data visualizations. To start, create a data set that just consists of the food types that are in the meat food group:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food_meat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>food</span>, <span class='va'>food_group</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"meat"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>food_meat</span>
</code></pre>
</div>
<pre><code># A tibble: 6 x 17
  item  food_group calories total_fat sat_fat cholesterol sodium carbs
  &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 Beef  meat            288      19.5    7.73          87    384     0
2 Chic meat            237      13.4    3.76          87    404     0
3 Duck  meat            132       5.9    2.32          77     74     0
4 Lamb  meat            292      20.7    8.76          96    394     0
5 Pork  meat            271      17      6.17          90    384     0
6 Turk meat            187       7      2.00          77     69     0
#  with 9 more variables: fiber &lt;dbl&gt;, sugar &lt;dbl&gt;, protein &lt;dbl&gt;,
#   iron &lt;dbl&gt;, vitamin_a &lt;dbl&gt;, vitamin_c &lt;dbl&gt;, wiki &lt;chr&gt;,
#   description &lt;chr&gt;, color &lt;chr&gt;</code></pre>
</div>
<p>One of the core ideas behind the Grammar of Graphics is that complex visualizations can be constructed by layering relatively simply elements on top of one another.</p>
<p>What if we wanted to put together two layers where one layer uses the <code>food</code> data set and the other uses <code>food_meat</code>? To do this, we can <em>override</em> the default data set in a layer with the option <code>data =</code>. This will use a different data set within a particular layer. For example, here is how we can layer the meat data set on top of the rest of the food items.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>calories</span>, y <span class='op'>=</span> <span class='va'>total_fat</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>calories</span>, y <span class='op'>=</span> <span class='va'>total_fat</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>food_meat</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-35-1.png" width="624" /></p>
</div>
<p>This plot, however, does not look any different than it would if we were just to plot all of the food together. The second layer of points just sits unassumingly on top of the rest of the data. To rectify this, we can color each layer a different color in order to distinguish them from one another. Lets try to highlight the meat food group in a navy blue, while making the rest of the points a light grey:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>calories</span>, y <span class='op'>=</span> <span class='va'>total_fat</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"grey85"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>calories</span>, y <span class='op'>=</span> <span class='va'>total_fat</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"navy"</span>, data <span class='op'>=</span> <span class='va'>food_meat</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-36-1.png" width="624" /></p>
</div>
<p>We now have a plot that shows exactly where the meats are relative to the other food items. We can further build up the plot by showing the names of just these rows of the dataset as well:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>calories</span>, y <span class='op'>=</span> <span class='va'>total_fat</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"grey85"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>calories</span>, y <span class='op'>=</span> <span class='va'>total_fat</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"navy"</span>, data <span class='op'>=</span> <span class='va'>food_meat</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span>
      <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>calories</span>, y <span class='op'>=</span> <span class='va'>total_fat</span>, label <span class='op'>=</span> <span class='va'>item</span><span class='op'>)</span>,
      color <span class='op'>=</span> <span class='st'>"navy"</span>,
      data <span class='op'>=</span> <span class='va'>food_meat</span>
    <span class='op'>)</span>
</code></pre>
</div>
<p><img src="elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-37-1.png" width="624" /></p>
</div>
<p>Notice that the code is starting to get a bit more complicated and some of the graphic layers are becoming a bit long. This is a good place to use the shorthand notation to inherit aesthetics across layers, like this:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>calories</span>, <span class='va'>total_fat</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"grey85"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"navy"</span>, data <span class='op'>=</span> <span class='va'>food_meat</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>item</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"navy"</span>, data <span class='op'>=</span> <span class='va'>food_meat</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-38-1.png" width="624" /></p>
</div>
<p>Notice how a relatively small set of commands can be put together in different ways to build a variety of plots. Already, we are making further progress towards building informative and beautiful graphics in R!</p>
<h3 id="selecting-columns">Selecting Columns</h3>
<p>It is also possible to take a subset of the columns in a data set. To do this, we make use of the verb <code>select</code>. We pass it the names of the variables we want to keep in the output data set, in the (possibly new) order that we want the columns to be arranged in. Here, for example, is a new version of the foods data set containing only the food item name followed by the amount of Vitamin A and Vitamin C:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>item</span>, <span class='va'>vitamin_a</span>, <span class='va'>vitamin_c</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 61 x 3
   item        vitamin_a vitamin_c
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
 1 Apple               1         8
 2 Asparagus          15         9
 3 Avocado             3        17
 4 Banana              1        15
 5 Chickpea            0         3
 6 String Bean        14        27
 7 Beef                0         0
 8 Bell Pepper        63       317
 9 Crab                0         5
10 Broccoli           12       149
#  with 51 more rows</code></pre>
</div>
<p>We will not need to use the <code>select</code> verb as often as <code>filter</code> because for the most part having extra variables around does not effect data visualizations or data models. However, it can be useful to displaying results and building tables.</p>
<p>As we saw above, the Vitamin A and Vitamin C columns were cut-off in the original output but are not visible in the selected data set version. Removing and reordering unneeded columns are important applied operations.</p>
<h3 id="arranging-rows">Arranging Rows</h3>
<p>The verb <code>filter</code> determined a subset of rows to keep from the original data set. The <code>arrange</code> verb, in contrast, keeps all of the original data but re-orders its rows.</p>
<p>Specifically, we give it one or more variable names and it sorts the data by the first variable from smallest to largest (or alphabetically for character variables). In the case of ties, the second variable is used if given. More variables can be given to further break additional ties. Here is an example where we order the data set first by <code>food_group</code> and then by <code>calories</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>food_group</span>, <span class='va'>calories</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 61 x 17
   item       food_group calories total_fat sat_fat cholesterol sodium
   &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;
 1 Milk       dairy            60       3.2   1.86           10     40
 2 Yogurt     dairy            99       1.1   0.742           5     53
 3 Sour Cream dairy           214      20.9  13.0            44     53
 4 Cheese     dairy           350      26.9  16.6            83    955
 5 Crab       fish             87       1     0.222          78    293
 6 Lobster    fish             97       0.5   0.106          71    700
 7 Haddock    fish            128       3.7   0.69           66    402
 8 Flounder   fish            133       4.2   0.867          56    417
 9 Shrimp     fish            144       2.3   0.446         206    613
10 Tuna       fish            153       3.9   0.811          53    366
#  with 51 more rows, and 10 more variables: carbs &lt;dbl&gt;,
#   fiber &lt;dbl&gt;, sugar &lt;dbl&gt;, protein &lt;dbl&gt;, iron &lt;dbl&gt;,
#   vitamin_a &lt;dbl&gt;, vitamin_c &lt;dbl&gt;, wiki &lt;chr&gt;, description &lt;chr&gt;,
#   color &lt;chr&gt;</code></pre>
</div>
<p>In the new data set all of the dairy products come up first followed by the fish products. Within each group, the items are sorted from the lowest to highest number of calories.</p>
<p>The ordering can be reversed (i.e., from the highest to the lowest value) be wrapping a variable in the function <code>desc()</code>, such as this ordering from the most saturated fat to the least:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>sat_fat</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 61 x 17
   item       food_group calories total_fat sat_fat cholesterol sodium
   &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;
 1 Cheese     dairy           350      26.9   16.6           83    955
 2 Sour Cream dairy           214      20.9   13.0           44     53
 3 Lamb       meat            292      20.7    8.76          96    394
 4 Beef       meat            288      19.5    7.73          87    384
 5 Pork       meat            271      17      6.17          90    384
 6 Chicken    meat            237      13.4    3.76          87    404
 7 Catfish    fish            240      14.5    3.25          69    398
 8 Halibut    fish            239      17.7    3.10          59    103
 9 Duck       meat            132       5.9    2.32          77     74
10 Cod        fish            211      10.8    2.22          57    401
#  with 51 more rows, and 10 more variables: carbs &lt;dbl&gt;,
#   fiber &lt;dbl&gt;, sugar &lt;dbl&gt;, protein &lt;dbl&gt;, iron &lt;dbl&gt;,
#   vitamin_a &lt;dbl&gt;, vitamin_c &lt;dbl&gt;, wiki &lt;chr&gt;, description &lt;chr&gt;,
#   color &lt;chr&gt;</code></pre>
</div>
<p>In the result here, Cheese has been placed at the top of the data set, followed by Sour Cream and Lamb.</p>
<h3 id="grouping-and-summarizing">Grouping and Summarizing</h3>
<p>A rather important verb is <code>summarize</code> that collapses a data frame by using summary functions. Using this verb requires that we explain exactly how the data should be summarized. We will introduce several helper functions to make this process slightly easier.</p>
<p>Lets start with an example. Here, we summarize our food data set by indicating the mean (average) value of the sugar variable across the entire data set:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>sugar</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 1
  `mean(sugar)`
          &lt;dbl&gt;
1          3.42</code></pre>
</div>
<p>A helper function will format the column a little differently that is more usable for data analysis.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>sugar</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 1
  sugar_mean
       &lt;dbl&gt;
1       3.42</code></pre>
</div>
<p>Here we used the function <code>sm_mean</code> inside of the function <code>summarize</code> to produce the output. We specified which variable to compute the mean of by giving its name inside of the <code>sm_mean</code> function. The results shows us that the average amount of sugar in a 100g portion of all of the foods is 3.419g.</p>
<p>In order to compute multiple summaries at once, we can pass multiple functions together are once. For example, here we compute the mean value of three nutritional measurements:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>sugar</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>calories</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>vitamin_a</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 3
  sugar_mean calories_mean vitamin_a_mean
       &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;
1       3.42          114.           16.1</code></pre>
</div>
<p>Notice that R creates a new data set and intelligently chooses the variable names. There are a number of other useful summary functions that work similarly, such as <code>sm_min</code>, <code>sm_max</code>, <code>sm_sum</code>, and <code>sm_sd</code> (standard deviation).</p>
<h2 id="multiple-output-values">Multiple output values</h2>
<p>Some summary functions return multiple columns for a given variable. For example, <code>sm_quartiles</code> gives the <em>five-number summary</em> of a variable: its minimum value, the first quartile (25th percentile), the median (50th percentile), the third quartile (75th percentile), and the maximum value. As with the other summary functions, smart variable names are automatically created in R:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/QuantileSummary.html'>sm_quartiles</a></span><span class='op'>(</span><span class='va'>calories</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 5
  calories_min calories_q1 calories_median calories_q3 calories_max
         &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
1           12          34              87         171          389</code></pre>
</div>
<p>Functions such as <code>sm_deciles</code> and <code>sm_percentiles</code> give a similar output, but with additional cutoff values. These can be useful in trying to describe the distribution of numeric variables in large data sets.</p>
<p>Summarizing the data set to a single row can be useful for understanding the general trends in a data set or highlighting outliers. However, the real power of the summary function comes when we pair it with grouped manipulations. This will allow us to produce summaries <em>within</em> one or more grouping variables in our data set.</p>
<p>When we use the <code>group_by</code> function, subsequent uses of the <code>summarize</code> function will produce a summary that describes the properties of variables within the variable used for grouping. The variable name(s) placed inside of the <code>group_by</code> function indicate which variable(s) should be used for the groups. For example, here we compute the mean number of calories of each food group:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>food_group</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>calories</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 6 x 2
  food_group calories_mean
* &lt;chr&gt;              &lt;dbl&gt;
1 dairy              181. 
2 fish               167. 
3 fruit               54.9
4 grains             196. 
5 meat               234. 
6 vegetable           37.4</code></pre>
</div>
<p>Notice that the output data set contains a column for the grouping variable (<code>food_group</code>) and the summarized variable (<code>calories_mean</code>). The summarized variable name is exactly the same as the non-grouped version and the final line of code looks exactly the same as before. However, the output data set now contains six rows, one for each food group.</p>
<p><strong>Any summarization function that can be used for an ungrouped data set can also be used for a grouped data set.</strong> Also, as before, we can put multiple summary functions together to obtain different measurements of each group.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>food_group</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>calories</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>total_fat</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 6 x 3
  food_group calories_mean total_fat_mean
* &lt;chr&gt;              &lt;dbl&gt;          &lt;dbl&gt;
1 dairy              181.          13.0  
2 fish               167.           7.22 
3 fruit               54.9          1.04 
4 grains             196.           2.56 
5 meat               234.          13.9  
6 vegetable           37.4          0.281</code></pre>
</div>
<p>Notice that the automatically produced variable names should make it clear which column corresponds to each summary function.</p>
<p>There are several additional summary functions that will be useful for analyzing data. The function <code>sm_count</code> takes no arguments and returns a variable called <code>count</code> that counts the total number of rows in the data set:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>food_group</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_count</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 6 x 2
  food_group count
* &lt;chr&gt;      &lt;int&gt;
1 dairy          4
2 fish          14
3 fruit         16
4 grains         5
5 meat           6
6 vegetable     16</code></pre>
</div>
<p>This tells us how many times each type of food group occurs in the data set. Similarly, the function <code>sm_na_count</code> tells us how many values of a variable are missing:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>food_group</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_count</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_na_count</a></span><span class='op'>(</span><span class='va'>calories</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 6 x 3
  food_group count calories_na_count
* &lt;chr&gt;      &lt;int&gt;             &lt;int&gt;
1 dairy          4                 0
2 fish          14                 0
3 fruit         16                 0
4 grains         5                 0
5 meat           6                 0
6 vegetable     16                 0</code></pre>
</div>
<p>In this case there are no missing values for the <code>calories</code> variable.</p>
<p>The summary function <code>sm_paste</code> collapses all of the values in a character variable. For example, applying this summary it to the <code>item</code> category after grouping by color, we can see all of the foods in the data set associated with a specific color:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>color</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_paste</a></span><span class='op'>(</span><span class='va'>item</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 8 x 2
  color  item_paste                                                   
* &lt;chr&gt;  &lt;chr&gt;                                                        
1 brown  Chickpea; Mushroom; Oat; Quinoa; Brown Rice                  
2 green  Asparagus; Avocado; String Bean; Bell Pepper; Broccoli; Cabb
3 orange Cantaloupe; Carrot; Orange; Sweet Potato; Tangerine          
4 pink   Grapefruit; Peach; Salmon; Shrimp                            
5 purple Grape; Plum                                                  
6 red    Apple; Beef; Crab; Duck; Lamb; Lobster; Strawberry; Tomato; 
7 white  Catfish; Cauliflower; Chicken; Clam; Cod; Flounder; Halibut;
8 yellow Banana; Cheese; Corn; Lemon; Pineapple                       </code></pre>
</div>
<p>Finally, note that it is possible to define your own summary functions using other R functions. To do this, we have to specify the name of the new variable explicitly. For example, here is an alternative way of computing the mean of the amount of Vitamin A within each food color:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>color</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span>avg_vitamin_a <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>vitamin_a</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>avg_vitamin_a</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 8 x 2
  color  avg_vitamin_a
  &lt;chr&gt;          &lt;dbl&gt;
1 orange        141.  
2 green          11.1 
3 pink            8.75
4 yellow          4.4 
5 purple          4   
6 red             2.78
7 white           2.63
8 brown           0   </code></pre>
</div>
<h3 id="geometries-for-summaries">Geometries for summaries</h3>
<p>We can use summarized data sets to produce new data visualizations. For example, consider summarizing the average number of calories, average total fat, and number of items in each food groups. We can take this data and construct a scatter plot that shows the average fat and calories of each food group, along with informative labels. Heres the code to make this visualization:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>food_group</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>calories</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>total_fat</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_count</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>calories_mean</span>, <span class='va'>total_fat_mean</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>size <span class='op'>=</span> <span class='va'>count</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"grey85"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>food_group</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-52-1.png" width="624" /></p>
</div>
<p>Scatterplots are often useful for displaying summarized information. There are two additional <code>geom</code> types that often are useful specifically for the case of summarized data sets.</p>
<p>If we want to create a bar plot, where the heights of the bars as given by a column in the data set, we can use the <code>geom_col</code> layer type. For this, assign a categorical variable to the <code>x</code>-aesthetic and the count variable to the <code>y</code>-aesthetic. For example, here is a bar plot showing the number of items in each food group:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>food_group</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_count</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_col</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>food_group</span>, y <span class='op'>=</span> <span class='va'>count</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-53-1.png" width="624" /></p>
</div>
<p>There are two specific things to keep in mind with the <code>geom_col</code> layer. First, there are two color-related <code>aes</code> categories: the border of the bars (<code>color</code>) and the color used to shade the inside of the bars (<code>fill</code>). We can change these exactly as we did with the single color value used with scatter plots. Also, if we want to produce a bar plot with horizontal bars, this can be done by adding the special layer <code>coord_flip()</code> at the end of the plotting command.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>food_group</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_count</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>food_group</span>, y <span class='op'>=</span> <span class='va'>count</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_col</span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"black"</span>, fill <span class='op'>=</span> <span class='st'>"white"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>coord_flip</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-54-1.png" width="624" /></p>
</div>
<p>I find that using a white fill color and a black border is often a good-looking starting point. Also, you will notice that making the bars horizontal will make it easier to read the category names when there are a larger number of categories.</p>
<p>It is possible to group a data set by multiple variables. To do this, we can provide additional variables to the <code>group_by</code> function separated by commas. For example, we could group the food data set into food group and color, and summarize each combination of the two:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>food_group</span>, <span class='va'>color</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_count</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>calories</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 21 x 4
# Groups:   food_group [6]
   food_group color  count calories_mean
   &lt;chr&gt;      &lt;chr&gt;  &lt;int&gt;         &lt;dbl&gt;
 1 dairy      white      3         124. 
 2 dairy      yellow     1         350  
 3 fish       pink       2         158. 
 4 fish       red        3         112. 
 5 fish       white      9         187. 
 6 fruit      green      4          77.2
 7 fruit      orange     3          44.7
 8 fruit      pink       2          35.5
 9 fruit      purple     2          57.5
10 fruit      red        2          42  
#  with 11 more rows</code></pre>
</div>
<p>Notice that now there is one row for each combination of the two groups. However, there is no row for combinations that do not exist. So, there is no row for pink dairy products nor for white fruit. Examples of several common uses for multiple groups are given in the exercises.</p>
<h3 id="mutate-verb">Mutate verb</h3>
<p>The final core <strong>dplyr</strong> verb that we will look at is used to create a new variable in our data set based on other variables that are already present. This verb is called <code>mutate</code>, and works by giving it the name of the variable you want to create followed by the code that describes how to construct the variable in terms of the rest of the data.</p>
<p>As an example, consider computing the number of calories in an 200g portion of each food. All of the variables in the data set are currently given as 100g portions, so to compute this we need to multiply the <code>calories</code> variables by 2. To do this, we use the <code>mutate</code> verb to name and describe a new variable <code>calories_200g</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>calories_200g <span class='op'>=</span> <span class='va'>calories</span> <span class='op'>*</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 61 x 18
   item       food_group calories total_fat sat_fat cholesterol sodium
   &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;
 1 Apple      fruit            52       0.1   0.028           0      1
 2 Asparagus  vegetable        20       0.1   0.046           0      2
 3 Avocado    fruit           160      14.6   2.13            0      7
 4 Banana     fruit            89       0.3   0.112           0      1
 5 Chickpea   grains          180       2.9   0.309           0    243
 6 String Be vegetable        31       0.1   0.026           0      6
 7 Beef       meat            288      19.5   7.73           87    384
 8 Bell Pepp vegetable        26       0     0.059           0      2
 9 Crab       fish             87       1     0.222          78    293
10 Broccoli   vegetable        34       0.3   0.039           0     33
#  with 51 more rows, and 11 more variables: carbs &lt;dbl&gt;,
#   fiber &lt;dbl&gt;, sugar &lt;dbl&gt;, protein &lt;dbl&gt;, iron &lt;dbl&gt;,
#   vitamin_a &lt;dbl&gt;, vitamin_c &lt;dbl&gt;, wiki &lt;chr&gt;, description &lt;chr&gt;,
#   color &lt;chr&gt;, calories_200g &lt;dbl&gt;</code></pre>
</div>
<p>Notice that there is a new variable named <code>calories_200g</code> that has been added as the last column in the data set. Because it is added at the end of the data set, it gets hidden in the output shown above. Making use of <code>select</code> allows us to see the new values:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>calories_200g <span class='op'>=</span> <span class='va'>calories</span> <span class='op'>*</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>item</span>, <span class='va'>food_group</span>, <span class='va'>calories</span>, <span class='va'>calories_200g</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 61 x 4
   item        food_group calories calories_200g
   &lt;chr&gt;       &lt;chr&gt;         &lt;dbl&gt;         &lt;dbl&gt;
 1 Apple       fruit            52           104
 2 Asparagus   vegetable        20            40
 3 Avocado     fruit           160           320
 4 Banana      fruit            89           178
 5 Chickpea    grains          180           360
 6 String Bean vegetable        31            62
 7 Beef        meat            288           576
 8 Bell Pepper vegetable        26            52
 9 Crab        fish             87           174
10 Broccoli    vegetable        34            68
#  with 51 more rows</code></pre>
</div>
<p>And now we can see that the new column has been created by doubling the number given the <code>calories</code> column.</p>
<p>Note that <code>mutate</code> can also be used to modify any existing column in the data set by using the name of an extant variable. In this case the position of the variable within the tables does not change.</p>
<p>The mutate verb itself has a relatively straightforward syntax. The main challenge is knowing how to apply and chain together the various transformations that are useful within an analysis. In the next few sections, we highlight several common types of operations that we will be useful in subsequent applications.</p>
<h2 id="conditional-values">Conditional values</h2>
<p>Many of the uses for the mutate verb involve assigning one value when a set of conditions is true and another if the conditions are false. For example, consider creating a new variable called <code>sugar_level</code> based on the relative amount of sugar in each food item. We might classify a food has having a high sugar level if has more than 10g of sugar per 100g serving, and a normal amount otherwise. In order to create this variable, we need the function <code>if_else</code>.</p>
<p>The <code>if_else</code> function has three parts: a TRUE/FALSE statement, the value to use when the statement is true, and the value to use when it is false. Here is an example to create our new variable:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>sugar_level <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span><span class='va'>sugar</span> <span class='op'>&gt;</span> <span class='fl'>10</span>, <span class='st'>"high"</span>, <span class='st'>"normal"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>item</span>, <span class='va'>food_group</span>, <span class='va'>sugar</span>, <span class='va'>sugar_level</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 61 x 4
   item        food_group sugar sugar_level
   &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;      
 1 Apple       fruit      10.4  high       
 2 Asparagus   vegetable   1.88 normal     
 3 Avocado     fruit       0.66 normal     
 4 Banana      fruit      12.2  high       
 5 Chickpea    grains      5.29 normal     
 6 String Bean vegetable   1.4  normal     
 7 Beef        meat        0    normal     
 8 Bell Pepper vegetable   4.2  normal     
 9 Crab        fish        0    normal     
10 Broccoli    vegetable   1.7  normal     
#  with 51 more rows</code></pre>
</div>
<p>Looking at the first rows of data, we see that apples and bananas are classified as high sugar foods, whereas the other sugar levels are given the sugar level category of normal.</p>
<p>The <code>if_else</code> function can be used to produce any number of categories by using it multiple times. Lets modify our sugar level variable to now have three categories: high (over 10g), low (less than 1g), and normal (between 1g and 10g). There are several different ways to get to the same result, but I find the easiest is to start by assigning a default value and then changing the value of the new variable in sequence. For example, here some code that produces our new categories:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>sugar_level <span class='op'>=</span> <span class='st'>"default"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>sugar_level <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span><span class='va'>sugar</span> <span class='op'>&lt;</span> <span class='fl'>1</span>, <span class='st'>"low"</span>, <span class='va'>sugar_level</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>sugar_level <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span><span class='va'>sugar</span> <span class='op'>&gt;</span> <span class='fl'>10</span>, <span class='st'>"high"</span>, <span class='va'>sugar_level</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>sugar_level <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span><span class='fu'>between</span><span class='op'>(</span><span class='va'>sugar</span>, <span class='fl'>1</span>, <span class='fl'>10</span><span class='op'>)</span>, <span class='st'>"normal"</span>, <span class='va'>sugar_level</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>item</span>, <span class='va'>food_group</span>, <span class='va'>sugar</span>, <span class='va'>sugar_level</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 61 x 4
   item        food_group sugar sugar_level
   &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;      
 1 Apple       fruit      10.4  high       
 2 Asparagus   vegetable   1.88 normal     
 3 Avocado     fruit       0.66 low        
 4 Banana      fruit      12.2  high       
 5 Chickpea    grains      5.29 normal     
 6 String Bean vegetable   1.4  normal     
 7 Beef        meat        0    low        
 8 Bell Pepper vegetable   4.2  normal     
 9 Crab        fish        0    low        
10 Broccoli    vegetable   1.7  normal     
#  with 51 more rows</code></pre>
</div>
<p>In each <code>if_else</code> step we are telling the mutate function that if the condition is false set <code>sugar_level</code> equal to itself. In other words, if the condition does not hold, do not change the value of the variable.</p>
<p>In may wonder why we created a default value for the variable <code>sugar_level</code>. It would have been one less line of code to set the default value to normal and remove the final mutate function. The reason for the approach above is three-fold. First, its easier to understand what the code is doing in its current format because each condition (high, normal, and low) is explicitly coded. Secondly, it creates a nice check on our code and data. If we find a row of the output that still has the value default we will know that there is a problem somewhere. Finally, the code above will more safely handle the issues with missing values, and issue that we will return to shortly.</p>
<h2 id="factors">Factors</h2>
<p>R has a special data type called a factor (abbreviated fct) that is specifically designed to handle categorical variables. It is typically not a good idea to store data as a factor because the resulting variables have some odd, error-producing, behaviors. However, it can be useful to create a factor as part of a mutate function just prior to creating a data visualizations.</p>
<p>For us, biggest difference between factors and character vectors is that a factor vector has a default ordered of its unique values, called the factors levels. Creating and understanding factors is useful because it allows us to change the ordering of categories within visualizations and models (which by default is done alphabetically).</p>
<p>One of the easiest ways to produce a factor variable with a given order is through the function <code>fct_inorder</code>. It will order the categories in the same order that they (first) appear in the data set. Combining this with the <code>arrange</code> function provides a lot of control over how categories become ordered. For example, the following code produces a bar plot of the food groups in our data set arranged from the largest category to the smallest category:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>food_group</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_count</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>count</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>food_group <span class='op'>=</span> <span class='fu'>fct_inorder</span><span class='op'>(</span><span class='va'>food_group</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_col</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>food_group</span>, <span class='va'>count</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-60-1.png" width="624" /></p>
</div>
<p>Other useful functions for manipulating categories include <code>fct_relevel</code> for manually putting one category first and <code>fct_lump_n</code> for combining together the smallest categories into a collective Other category.</p>
<h3 id="mutate-summaries">Mutate summaries</h3>
<p>All of summary functions that were introduced in the previous notebook can also be applied within the mutate version. Instead of reducing the data to a single summary row, summarizing within the mutate verb duplicates the summary statistic in each row of the data set. Here is an example of including the average number of calories across all rows of the data set:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>calories</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 61 x 18
   item       food_group calories total_fat sat_fat cholesterol sodium
   &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;
 1 Apple      fruit            52       0.1   0.028           0      1
 2 Asparagus  vegetable        20       0.1   0.046           0      2
 3 Avocado    fruit           160      14.6   2.13            0      7
 4 Banana     fruit            89       0.3   0.112           0      1
 5 Chickpea   grains          180       2.9   0.309           0    243
 6 String Be vegetable        31       0.1   0.026           0      6
 7 Beef       meat            288      19.5   7.73           87    384
 8 Bell Pepp vegetable        26       0     0.059           0      2
 9 Crab       fish             87       1     0.222          78    293
10 Broccoli   vegetable        34       0.3   0.039           0     33
#  with 51 more rows, and 11 more variables: carbs &lt;dbl&gt;,
#   fiber &lt;dbl&gt;, sugar &lt;dbl&gt;, protein &lt;dbl&gt;, iron &lt;dbl&gt;,
#   vitamin_a &lt;dbl&gt;, vitamin_c &lt;dbl&gt;, wiki &lt;chr&gt;, description &lt;chr&gt;,
#   color &lt;chr&gt;, calories_mean &lt;dbl&gt;</code></pre>
</div>
<p>As with any call to mutate, all of the original variables are kept in the output and the new variable is added at the end. Using <code>select</code> we can verify that the average calories has in fact been added to each row of the table.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>calories</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>item</span>, <span class='va'>food_group</span>, <span class='va'>calories</span>, <span class='va'>calories_mean</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 61 x 4
   item        food_group calories calories_mean
   &lt;chr&gt;       &lt;chr&gt;         &lt;dbl&gt;         &lt;dbl&gt;
 1 Apple       fruit            52          114.
 2 Asparagus   vegetable        20          114.
 3 Avocado     fruit           160          114.
 4 Banana      fruit            89          114.
 5 Chickpea    grains          180          114.
 6 String Bean vegetable        31          114.
 7 Beef        meat            288          114.
 8 Bell Pepper vegetable        26          114.
 9 Crab        fish             87          114.
10 Broccoli    vegetable        34          114.
#  with 51 more rows</code></pre>
</div>
<p>The power of mutate summaries becomes particularly clear when grouping the data. If we group the data set by one or more variables and apply a summary function within a mutation, the repeated summaries will be done within each group. Here is an example of adding the average calories of each food group to the data set:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>food_group</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/SingleSummary.html'>sm_mean</a></span><span class='op'>(</span><span class='va'>calories</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>item</span>, <span class='va'>food_group</span>, <span class='va'>calories</span>, <span class='va'>calories_mean</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 61 x 4
# Groups:   food_group [6]
   item        food_group calories calories_mean
   &lt;chr&gt;       &lt;chr&gt;         &lt;dbl&gt;         &lt;dbl&gt;
 1 Apple       fruit            52          54.9
 2 Asparagus   vegetable        20          37.4
 3 Avocado     fruit           160          54.9
 4 Banana      fruit            89          54.9
 5 Chickpea    grains          180         196. 
 6 String Bean vegetable        31          37.4
 7 Beef        meat            288         234. 
 8 Bell Pepper vegetable        26          37.4
 9 Crab        fish             87         167. 
10 Broccoli    vegetable        34          37.4
#  with 51 more rows</code></pre>
</div>
<p>Following this with a filter, for example, would allow us to select all of the foods that have a less than average number of calories within their food group. We will see many examples of grouped mutate summaries throughout our applications.</p>
<h2 id="labels-and-themes">Labels and themes</h2>
<p>We have seen a number of ways to create and modify data visualizations. One thing that we did not cover was how to label our axes.</p>
<p>While many data visualization guides like to stress the importance of labelling axes, while in the exploratory phase of analysis it is often best to simply use the default labels provided by R. These are useful for a number of reasons. First, they require minimal effort and make it easy to tweak axes, variables, and other settings without spending time tweaking with the labels. Secondly, the default labels use the variable names in our dataset. When writing code this is <em>exactly</em> what we need to know about a variable to use it in additional plots, models, and data manipulation tasks.</p>
<p>Of course, once we want to present our results to others, it is essential to provide more detailed descriptions of the axes and legends in our plot. Fortunately, this is relatively easy using the grammar of graphics.</p>
<p>In order to change the labels in a plot, we can use the <code>labs</code> function as an extra part of our plot. Inside the function, we assign labels to the names of aes values that you want to describe. Leaving a value unspecified will keep the default value in place. Labels for the x-axis and y-axis will be go on the sides of the plot. Labels for other aesthetics such as size and color will be placed in the legend. Here is an example of a scatterplot with labels for the three aesthetics:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>calories</span>, y <span class='op'>=</span> <span class='va'>sat_fat</span>, color <span class='op'>=</span> <span class='va'>food_group</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>
      x <span class='op'>=</span> <span class='st'>"Calories per 100g"</span>,
      y <span class='op'>=</span> <span class='st'>"Saturated Fat (grams per 100g)"</span>,
      color <span class='op'>=</span> <span class='st'>"Food Group"</span>
    <span class='op'>)</span>
</code></pre>
</div>
<p><img src="elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-64-1.png" width="624" /></p>
</div>
<p>Notice that the descriptions inside of the <code>labs</code> function is fairly long. The code here breaks it up by putting each argument on its own line (indented a further two spaces). This is good practice when using functions with a lot of arguments.</p>
<p>We can also had a title (and optional subtitle and caption) to the plot by adding these as named arguments to the <code>labs</code> function.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>calories</span>, y <span class='op'>=</span> <span class='va'>sat_fat</span>, color <span class='op'>=</span> <span class='va'>food_group</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>
      title <span class='op'>=</span> <span class='st'>"Main title"</span>,
      subtitle <span class='op'>=</span> <span class='st'>"A little more detail"</span>,
      caption <span class='op'>=</span> <span class='st'>"Perhaps the source of the data?"</span>
    <span class='op'>)</span>
</code></pre>
</div>
<p><img src="elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-65-1.png" width="624" /></p>
</div>
<p>Another way to prepare our graphics for publication is to modify the <em>theme</em> of a plot. One useful option is to set the default plot to <code>theme_minimal</code>. As the name implies, it removes most of the clutter of other choices while keeping grid lines and other visual cues to help interpret a dataset.</p>
<p>When presenting information for external publication, I prefer to use the theme called <code>theme_sm</code> based on the work of Edward Tufte. To set the theme, just call the following line of code sometime before making your plot:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'>theme_set</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/smodels/man/theme_sm.html'>theme_sm</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now, when we construct a plot it will use the newly assigned theme:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>food</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>sugar</span>, y <span class='op'>=</span> <span class='va'>total_fat</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="elements-of-distill-and-rmarkdown_files/figure-html5/unnamed-chunk-67-1.png" width="624" /></p>
</div>
<p>The Tufte theme is designed to use as little ink as possible, thus focusing the reader on the data. It can be a bit too minimal when first exploring the dataset, but is a great tool for presenting your results.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
