<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Driving Through a Random Forest: Predicting Automobile Demand</title>
  
  <meta property="description" itemprop="description" content="Predictive Performance"/>
  
  
  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-03-15"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-03-15"/>
  <meta name="article:author" content="Jonathan Arnold"/>
  <meta name="article:author" content="Sheng Chao Ho"/>
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Driving Through a Random Forest: Predicting Automobile Demand"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Predictive Performance"/>
  <meta property="og:locale" content="en_US"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Driving Through a Random Forest: Predicting Automobile Demand"/>
  <meta property="twitter:description" content="Predictive Performance"/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","categories"]}},"value":[{"type":"character","attributes":{},"value":["Driving Through a Random Forest: Predicting Automobile Demand"]},{"type":"character","attributes":{},"value":["Predictive Performance \n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Jonathan Arnold"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Sheng Chao Ho"]}]}]},{"type":"character","attributes":{},"value":["03-15-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["Jonathan and Sheng"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/CART_plot_pred_and_vip-1.png","jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/LASSO_plot_pred_and_vip-1.png","jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/RF_plot_pred_and_vip-1.png","jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-10-1.png","jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-12-1.png","jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-15-1.png","jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-18-1.png","jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-19-1.png","jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-2-1.png","jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-7-1.png","jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/XGB_plot_pred_and_vip-1.png","Model_panel_cleaned.dta"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }
  
  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }
  
  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }
  
  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }
  
  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }
  
  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }
  
  d-article h3 {
    margin-top: 1.5rem;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  /* Tweak code blocks */
  
  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }
  
  d-article div.sourceCode {
    background-color: white;
  }
  
  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  d-article pre a {
    border-bottom: none;
  }
  
  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }
  
  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }
  
  @media(min-width: 768px) {
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }
  
  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }
  
  d-article pre {
    font-size: 14px;
  }
  
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for d-contents */
  
  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }
  
  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }
  
  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }
  
  .d-contents li {
    list-style-type: none
  }
  
  .d-contents nav > ul {
    padding-left: 0;
  }
  
  .d-contents ul {
    padding-left: 1em
  }
  
  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }
  
  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }
  
  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }
  
  .d-contents nav > ul > li > a {
    font-weight: 600;
  }
  
  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }
  
  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }
  
  
  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }
  
  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }
  
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  /* Citations */
  
  d-article .citation {
    color: inherit;
    cursor: inherit;
  }
  
  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }
  
  /* Citation hover box */
  
  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }
  
  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  /* Include appendix styles here so they can be overridden */
  
  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }
  
  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }
  
  d-appendix h3 + * {
    margin-top: 1em;
  }
  
  d-appendix ol {
    padding: 0 0 0 15px;
  }
  
  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }
  
  d-appendix li {
    margin-bottom: 1em;
  }
  
  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  d-appendix > * {
    grid-column: text;
  }
  
  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }
  
  /* Include footnote styles here so they can be overridden */
  
  d-footnote-list {
    contain: layout style;
  }
  
  d-footnote-list > * {
    grid-column: text;
  }
  
  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }
  
  
  
  /* Anchor.js */
  
  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .custom p {
    margin-bottom: 0.5em;
  }
  
  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }
  
  /* Styles for posts lists (not auto-injected) */
  
  
  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }
  
  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }
  
  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }
  
  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }
  
  .post-preview-last {
    border-bottom: none !important;
  }
  
  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }
  
  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }
  
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }
  
  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }
  
  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }
  
  .posts-list .metadata > * {
    display: inline-block;
  }
  
  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }
  
  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }
  
  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }
  
  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  .posts-list img {
    opacity: 1;
  }
  
  .posts-list img[data-src] {
    opacity: 0;
  }
  
  .posts-more {
    clear: both;
  }
  
  
  .posts-sidebar {
    font-size: 16px;
  }
  
  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }
  
  .sidebar-section {
    margin-bottom: 30px;
  }
  
  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
  
  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }
  
  .categories li>a {
    border-bottom: none;
  }
  
  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }
  
  .categories .active {
    font-weight: 600;
  }
  
  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }
  
  
  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  .downlevel .posts-list .post-preview {
    color: inherit;
  }
  
  
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }
  
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();
  
    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-contents').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <link href="jonathan-sheng-algorithmic-demand-estimation-prediction_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
  <script src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/pagedtable-1.1/js/pagedtable.js"></script>
  <script src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/popper-2.6.0/popper.min.js"></script>
  <link href="jonathan-sheng-algorithmic-demand-estimation-prediction_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="jonathan-sheng-algorithmic-demand-estimation-prediction_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Driving Through a Random Forest: Predicting Automobile Demand","description":"Predictive Performance","authors":[{"author":"Jonathan Arnold","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""},{"author":"Sheng Chao Ho","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-03-15T00:00:00.000+00:00","citationText":"Arnold & Ho, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Driving Through a Random Forest: Predicting Automobile Demand</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt=tag">Jonathan and Sheng</div>
</div>
<!--/radix_placeholder_categories-->
<p>Predictive Performance</p>
</div>

<div class="d-byline">
  
  Jonathan Arnold
  
,   
  Sheng Chao Ho
  
<br/>03-15-2021
</div>

<div class="d-article">
<!-- Load some general packages, plus load and process data -->
<h2 id="introduction">Introduction</h2>
<p>In this post, we will use four algorithmic models to predict market shares of automobiles using price, demographic characteristics, and characteristics of the vehicles. The four algorithms we will use are LASSO, CART, Random Forest, and Boosting (we use xgboost for implementation). We will tune these models using 10-fold cross-validation and a discrete grid of hyperparameters, and select the vector of hyperparameters which gives us the smallest root mean squared error (RMSE). Then we will compare the predictive accuracy of the four models to each other, and discuss the results.</p>
<h2 id="data-preprocessing">Data Preprocessing</h2>
<p>We begin by loading the data:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df_raw</span> <span class='op'>&lt;-</span> <span class='fu'>haven</span><span class='fu'>::</span><span class='fu'><a href='https://haven.tidyverse.org/reference/read_dta.html'>read_dta</a></span><span class='op'>(</span><span class='st'>"Model_panel_cleaned.dta"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>As a reminder, this data contains 88 variables and 6877 observations. Many of these variables are duplicates, and some variables we’d like to use (like market share) are not included in the dataset.</p>
<h1 id="data-cleaning">Data Cleaning</h1>
<p>We clean the data by first dropping a large number of variables which are either duplicates, have zero variance, or are otherwise unnecessary. We take logs of most numeric variables in order to make the distributions more symmetric. Then we clean some problematic observations in the nationality variable. Finally, we make sure that all character vectors in the data frame are converted to factors, so that the models know how to process them.</p>
<p>Perhaps the most important step is calculating market share. In the style of BLP, we take the sales for each vehicle and divide it by the number of households in the United States for that year. This is based on the implicit assumption that the market size for the automobile market is all household in the US for a given year. Remember that “markets” here simply refer to a year.</p>
<p>Finally, we calculate a couple of price ratios to capture some notion of cross-price elasticity in the predictive process: the ratio of the price to the average price in the market, and the ratio of the price to the average price of the same class of vehicle in the market.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df</span><span class='op'>&lt;-</span> <span class='va'>df_raw</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='fu'>starts_with</span><span class='op'>(</span><span class='st'>"I_"</span><span class='op'>)</span>,<span class='op'>-</span><span class='va'>count_trim</span>,<span class='op'>-</span><span class='va'>Model_id</span>,<span class='op'>-</span><span class='va'>MY_id</span>,
         <span class='op'>-</span><span class='va'>nationality1</span>,<span class='op'>-</span><span class='va'>nationality2</span>,
         <span class='op'>-</span><span class='va'>korea</span>,<span class='op'>-</span><span class='va'>mexico</span>,<span class='op'>-</span><span class='va'>netherlands</span>,<span class='op'>-</span><span class='va'>spain</span>,<span class='op'>-</span><span class='va'>italy</span>,<span class='op'>-</span><span class='va'>germany</span>,
         <span class='op'>-</span><span class='va'>france</span>,<span class='op'>-</span><span class='va'>uk</span>,<span class='op'>-</span><span class='va'>sweden</span>,<span class='op'>-</span><span class='va'>japan</span>,<span class='op'>-</span><span class='va'>indian</span>,<span class='op'>-</span><span class='va'>china</span>,<span class='op'>-</span><span class='va'>canada</span>,
         <span class='op'>-</span><span class='fu'>starts_with</span><span class='op'>(</span><span class='st'>"income_"</span><span class='op'>)</span>,<span class='op'>-</span><span class='va'>gas_nominal</span>,<span class='op'>-</span><span class='va'>gas_real</span>,
         <span class='op'>-</span><span class='va'>car_size</span>,<span class='op'>-</span><span class='va'>car_volume</span>,<span class='op'>-</span><span class='va'>hp_to_cyl</span>,<span class='op'>-</span><span class='va'>hp_to_weight</span>,
         <span class='op'>-</span><span class='va'>transmission_id</span>,<span class='op'>-</span><span class='va'>drivetype_id</span>,<span class='op'>-</span><span class='va'>body_original</span>,
         <span class='op'>-</span><span class='va'>model_age</span>,<span class='op'>-</span><span class='va'>engine_hp</span>,<span class='op'>-</span><span class='va'>mpg_combined</span>,<span class='op'>-</span><span class='va'>dpm_combined</span>,
         <span class='op'>-</span><span class='va'>curb_weight_lbs</span>,<span class='op'>-</span><span class='va'>trim_name</span>,<span class='op'>-</span><span class='va'>cpi</span>,<span class='op'>-</span><span class='va'>log_mpg_combined</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>log_mpg_city<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>mpg_city</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>log_mpg_hwy<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>mpg_hwy</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>log_dpm_city<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>dpm_city</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>log_dpm_hwy<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>dpm_hwy</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>nationality<span class='op'>=</span><span class='fu'>case_when</span><span class='op'>(</span><span class='va'>nationality</span><span class='op'>%in%</span>
                                 <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Italy/US"</span>,<span class='st'>"Germany/US"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"US"</span>,
                                  <span class='va'>nationality</span> <span class='op'>==</span> <span class='st'>""</span> <span class='op'>~</span> <span class='st'>"US"</span>,
                                  <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>nationality</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>mpg_city</span>,<span class='va'>mpg_hwy</span>,<span class='va'>dpm_city</span>,<span class='va'>dpm_hwy</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate_if</span><span class='op'>(</span><span class='va'>is.character</span>,<span class='va'>as.factor</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>share<span class='op'>=</span><span class='va'>sales</span><span class='op'>/</span><span class='op'>(</span><span class='va'>nb_hh</span><span class='op'>*</span><span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>Year</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>own_mkt_price_ratio<span class='op'>=</span><span class='va'>price</span><span class='op'>/</span><span class='op'>(</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>price</span><span class='op'>)</span><span class='op'>-</span><span class='va'>price</span><span class='op'>)</span><span class='op'>/</span><span class='op'>(</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>class</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>own_class_price_ratio<span class='op'>=</span><span class='va'>price</span><span class='op'>/</span><span class='op'>(</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>price</span><span class='op'>)</span><span class='op'>-</span><span class='va'>price</span><span class='op'>)</span><span class='op'>/</span><span class='op'>(</span><span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='va'>ungroup</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>sales</span>,<span class='op'>-</span><span class='va'>nb_hh</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>drop_na</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>df</span><span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="data-splitting">Data Splitting</h1>
<p>Now we need to split the data into training and test samples, along with creating some cross-validation folds within the training set. Before we do so, let’s have a brief look at the distribution of market shares in the data:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df</span> <span class='op'>%&gt;%</span> <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>share</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>geom_histogram</span><span class='op'>(</span>alpha<span class='op'>=</span><span class='fl'>0.8</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Market Share"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-2-1.png" width="624" /></p>
</div>
<p>The distribution of market shares is heavily right-skewed, which can present a problem when splitting the data. We don’t want all of the high market share observations to end up in either the training or the test set. Thus, we employ stratified sampling with respect to the market share. This means that we first split up the data by market share quartiles, and sample separately from each of these quartiles. This preserves the distribution of market shares between the training and test samples.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span>
<span class='va'>df_split</span> <span class='op'>&lt;-</span> <span class='fu'>initial_split</span><span class='op'>(</span><span class='va'>df</span>, strata <span class='op'>=</span> <span class='va'>share</span><span class='op'>)</span>
<span class='va'>df_train</span> <span class='op'>&lt;-</span> <span class='fu'>training</span><span class='op'>(</span><span class='va'>df_split</span><span class='op'>)</span>
<span class='va'>df_test</span> <span class='op'>&lt;-</span> <span class='fu'>testing</span><span class='op'>(</span><span class='va'>df_split</span><span class='op'>)</span>
<span class='va'>df_folds</span> <span class='op'>&lt;-</span> <span class='fu'>vfold_cv</span><span class='op'>(</span><span class='va'>df_train</span>, strata <span class='op'>=</span> <span class='va'>share</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h1 id="creating-a-recipe">Creating a Recipe</h1>
<p>In the tidymodels framework, the basis for the model is a recipe: a set of instructions that tell the algorithm what type of <span class="math inline">\(y=f(x)\)</span> formula it is modeling, and any final preprocessing that needs to occur. In our case, we want our <span class="math inline">\(y\)</span>, or outcome, to be market share, and our <span class="math inline">\(x\)</span>, or predictors, to be all of the remaining variables. We choose to exclude “year” from this list as its function in the data is simply to denote which market an observation is in.</p>
<p>There is one major issue with the data in its current form: the total number of levels for all the categorical variables (model, company, nationality, etc.) is almost 800! That translates to almost 800 extra dummy variables when fitting the models. To avoid this explosion in the number of variables, we use the “step_other” function to collapse all the factor levels below a certain threshold. This threshold was chosen by us, the modelers, and the thresholds result in the total number of variables being only slightly greater than 100.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>demand_recipe</span><span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span>formula<span class='op'>=</span> <span class='va'>share</span> <span class='op'>~</span><span class='va'>.</span>, data<span class='op'>=</span><span class='va'>df_train</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>update_role</span><span class='op'>(</span><span class='va'>Year</span>, new_role<span class='op'>=</span><span class='st'>"Market"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_other</span><span class='op'>(</span><span class='va'>company</span>,threshold<span class='op'>=</span><span class='fl'>0.05</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_other</span><span class='op'>(</span><span class='va'>brand</span>,<span class='va'>nationality</span>,<span class='va'>suv_class</span>,threshold<span class='op'>=</span><span class='fl'>0.02</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_other</span><span class='op'>(</span><span class='va'>model</span>,threshold<span class='op'>=</span><span class='fl'>0.0045</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_dummy</span><span class='op'>(</span><span class='fu'>all_nominal</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<!-- Tune? -->
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="fitting-the-models">Fitting the Models</h2>
<h1 id="lasso">LASSO</h1>
<p>LASSO is a regularized linear regression model, and essentially functions as a means to accomplish variable selection algorithmically. In order to do this, a penalty is imposed, and that penalty is the hyperparameter we need to tune.</p>
<p>In order for this penalty to make sense, we have to normalize all of the predictors. Otherwise, the penalty we be applied differently depending on the scale and location of that predictor’s distribution.</p>
<!-- LASSO -->
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>glmnet_recipe</span> <span class='op'>&lt;-</span> 
  <span class='va'>demand_recipe</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_normalize</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, <span class='op'>-</span><span class='fu'>all_nominal</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> 

<span class='va'>glmnet_spec</span> <span class='op'>&lt;-</span> 
  <span class='fu'>linear_reg</span><span class='op'>(</span>penalty <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, mixture <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"glmnet"</span><span class='op'>)</span> 

<span class='va'>glmnet_workflow</span> <span class='op'>&lt;-</span> 
  <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>glmnet_recipe</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>glmnet_spec</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>We tune the model using 10-fold cross-validation, and select the best model based on RMSE. Then we fit this model one last time to the training set.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>63663</span><span class='op'>)</span>

<span class='va'>glmnet_tune</span> <span class='op'>&lt;-</span> 
  <span class='fu'>tune_grid</span><span class='op'>(</span><span class='va'>glmnet_workflow</span>, 
            resamples <span class='op'>=</span> <span class='va'>df_folds</span>, 
            grid <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span> 

<span class='fu'>show_best</span><span class='op'>(</span><span class='va'>glmnet_tune</span>, metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>
<span class='co'>#Best model is penalty = 2.037462e-10</span>


<span class='va'>final_glmnet</span> <span class='op'>&lt;-</span> 
  <span class='va'>glmnet_workflow</span> <span class='op'>%&gt;%</span>
  <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='fu'>select_best</span><span class='op'>(</span><span class='va'>glmnet_tune</span>, metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span><span class='op'>)</span>
  
<span class='va'>glmnet_fit</span> <span class='op'>&lt;-</span> <span class='fu'>last_fit</span><span class='op'>(</span><span class='va'>final_glmnet</span>, <span class='va'>df_split</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["model"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["penalty"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["rmse"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"2.037462e-10","3":"0.0005341767"},{"1":"2","2":"1.614249e-09","3":"0.0005341767"},{"1":"3","2":"2.999630e-08","3":"0.0005341777"},{"1":"4","2":"1.036695e-07","3":"0.0005343889"},{"1":"5","2":"1.663465e-06","3":"0.0005372265"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<p>The above table shows the RMSE results for the top five models. We can see that the RMSE is increasing in the penalty hyperparameter, meaning that a lower penalty is superior. This corresponds to less regularization, and thus more non-zero coefficients in the regression.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Finally, we run the tuned model on the test set and plot the resulting market share predictions in comparison to the actual values.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>glmnet_plot</span> <span class='op'>&lt;-</span> <span class='co'>#Plot of predictions vs truth</span>
  <span class='fu'>collect_predictions</span><span class='op'>(</span><span class='va'>glmnet_fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>share</span>, <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span>lty <span class='op'>=</span> <span class='fl'>2</span>, color <span class='op'>=</span> <span class='st'>"gray50"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.5</span>, color <span class='op'>=</span> <span class='st'>"midnightblue"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>coord_fixed</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>glmnet_plot</span>
</code></pre>
</div>
<p><img src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/LASSO_plot_pred_and_vip-1.png" width="624" /></p>
</div>
<p>The plot above shows an adequate performance for this model. Errors are still sizable, and there even appears to be somewhat of a downward bias to the model. Predictions tend to be worse for the rarer, larger market shares.</p>
<p>Now we examine variable importance in this model. What are the features that LASSO selects as most important for predicting automobile market share?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>glmnet_vip</span> <span class='op'>&lt;-</span> 
  <span class='va'>glmnet_fit</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>pluck</span><span class='op'>(</span><span class='st'>".workflow"</span>, <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>   
   <span class='fu'>pull_workflow_fit</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>vip</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/vip/man/vip.html'>vip</a></span><span class='op'>(</span>num_features <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>

<span class='va'>glmnet_vip</span>
</code></pre>
</div>
<p><img src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-7-1.png" width="624" /></p>
</div>
<p>Somewhat surprisingly, the own/class price ratio appears as the most important, followed by price. This suggests that the price relationship between a car model and its competitors inside the same class of vehicle significantly contributes to its market share.</p>
<p>In addition, we see some of the introduced dummy variables emerge as important, particular Ford and specifically its F-series pickup trucks. These trucks have unusually high market shares, so perhaps their shares are not able to be predicted just by their characteristics.</p>
<h1 id="cart">CART</h1>
<p>The next model we will use is a regression tree. The regression tree uses a greedy algorithm to perform recursive splits on the data. If allowed to grow large, these learners can have quite high variance and risk over-fitting. Thus, we use three tuning parameters to “prune” the tree: a complexity cost, a maximum tree depth, and a minimum number of observations per split.</p>
<!-- CART -->
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cart_recipe</span> <span class='op'>&lt;-</span> 
  <span class='va'>demand_recipe</span>

<span class='va'>cart_spec</span> <span class='op'>&lt;-</span> 
  <span class='fu'>decision_tree</span><span class='op'>(</span>cost_complexity <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, tree_depth<span class='op'>=</span><span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, min_n <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"rpart"</span><span class='op'>)</span> 

<span class='va'>cart_workflow</span> <span class='op'>&lt;-</span> 
  <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>cart_recipe</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>cart_spec</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>We tune the model using a discrete grid, and then fit the best model to the training data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>63663</span><span class='op'>)</span>

<span class='va'>cart_tune</span> <span class='op'>&lt;-</span>
  <span class='fu'>tune_grid</span><span class='op'>(</span><span class='va'>cart_workflow</span>, 
            resamples <span class='op'>=</span> <span class='va'>df_folds</span>, 
            grid <span class='op'>=</span> <span class='fl'>30</span>,
            control <span class='op'>=</span> <span class='fu'>control_grid</span><span class='op'>(</span>verbose <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>show_best</span><span class='op'>(</span><span class='va'>cart_tune</span>, metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>
<span class='co'>#Best model is cost_complexity = 2.022630e-09, tree_depth = 12, min_n = 12</span>


<span class='va'>final_cart</span> <span class='op'>&lt;-</span> <span class='va'>cart_workflow</span> <span class='op'>%&gt;%</span>
  <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='fu'>select_best</span><span class='op'>(</span><span class='va'>cart_tune</span>, metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>fit</span><span class='op'>(</span><span class='va'>df_train</span><span class='op'>)</span>

<span class='va'>cart_fit</span> <span class='op'>&lt;-</span> <span class='fu'>last_fit</span><span class='op'>(</span><span class='va'>final_cart</span>, <span class='va'>df_split</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Below we show the results for the top 5 models.</p>
<div class="layout-chunk" data-layout="l-body">
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["model"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["cost_complexity"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["tree_depth"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["min_n"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["rmse"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"2.022630e-09","3":"12","4":"12","5":"0.0004174716"},{"1":"2","2":"1.257329e-07","3":"11","4":"3","5":"0.0004367383"},{"1":"3","2":"4.608657e-06","3":"15","4":"23","5":"0.0004383926"},{"1":"4","2":"2.564866e-07","3":"14","4":"26","5":"0.0004563562"},{"1":"5","2":"1.029368e-04","3":"14","4":"26","5":"0.0004577715"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<p>We can see that the RMSE decreases as complexity cost decreases, minimum number of observations per node decreases, and tree depth decreases (slightly).</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Let’s examine the tuned model’s predictive accuracy on the test set. Below we plot the predicted vs. actual market shares.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cart_plot</span> <span class='op'>&lt;-</span> <span class='co'>#Plot of predictions vs truth</span>
  <span class='fu'>collect_predictions</span><span class='op'>(</span><span class='va'>cart_fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>share</span>, <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span>lty <span class='op'>=</span> <span class='fl'>2</span>, color <span class='op'>=</span> <span class='st'>"gray50"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.5</span>, color <span class='op'>=</span> <span class='st'>"midnightblue"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>coord_fixed</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>cart_plot</span>
</code></pre>
</div>
<p><img src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/CART_plot_pred_and_vip-1.png" width="624" /></p>
</div>
<p>The horizontal lines of predictions demonstrate the discretizing effect that CART tends to have on the outcome space. However, the model appears to have a decent fit, albeit with fairly high variance.</p>
<p>Here is the variable importance plot for CART:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cart_vip</span> <span class='op'>&lt;-</span> 
  <span class='va'>cart_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pluck</span><span class='op'>(</span><span class='st'>".workflow"</span>, <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>   
  <span class='fu'>pull_workflow_fit</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>vip</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/vip/man/vip.html'>vip</a></span><span class='op'>(</span>num_features <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>

<span class='va'>cart_vip</span>
</code></pre>
</div>
<p><img src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-10-1.png" width="624" /></p>
</div>
<p>We see some similarities with LASSO, like the presence of the F-series dummy again and the prominence of price, but some variables are reordered and others are new altogether. Note that variables related to car size and volume seem to take a more prominent role here.</p>
<p>Decision trees generally come with an added benefit of interpretability, so let’s take a closer look at the model itself:</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>rpart.plot</span><span class='op'>(</span><span class='va'>final_cart</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-12-1.png" width="624" /></p>
</div>
<p>This is quite a large tree, and a bit difficult to interpret. We may be able to faintly make out that the first split is along the F-series dummy, and further early splits pertain to price and price ratios, but much more than that becomes quite complex. Perhaps the interpretability advantage of a single tree is not so significant in our case.</p>
<h1 id="random-forest">Random Forest</h1>
<p>With this relative lack of interpretability in mind, we will take it a few steps further by fitting a random forest to our data. Here we will tune just a couple of parameters: mtry, which is the number of variables considered at each split point, and min_n, which is the minimum number of observations per split. We don’t tune the number of trees; instead, we select the sufficiently large number of 500.</p>
<!-- Random Forest -->
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf_recipe</span> <span class='op'>&lt;-</span> 
  <span class='va'>demand_recipe</span>

<span class='va'>rf_spec</span> <span class='op'>&lt;-</span> 
  <span class='fu'>rand_forest</span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, min_n <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, trees <span class='op'>=</span> <span class='fl'>500</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"ranger"</span><span class='op'>)</span> 

<span class='va'>rf_workflow</span> <span class='op'>&lt;-</span> 
  <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>rf_recipe</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>rf_spec</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>We will now tune the model using 10-fold cross-validation.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>63663</span><span class='op'>)</span>

<span class='va'>rf_tune</span> <span class='op'>&lt;-</span> <span class='fu'>tune_grid</span><span class='op'>(</span><span class='va'>rf_workflow</span>, 
                     resamples <span class='op'>=</span> <span class='va'>df_folds</span>, 
                     grid <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span>

<span class='fu'>show_best</span><span class='op'>(</span><span class='va'>rf_tune</span>, metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>
<span class='co'>#Best model is mtry = 10, min_n = 4</span>


<span class='va'>final_rf</span> <span class='op'>&lt;-</span> <span class='va'>rf_workflow</span> <span class='op'>%&gt;%</span>
  <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='fu'>select_best</span><span class='op'>(</span><span class='va'>rf_tune</span>, metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>rf_fit</span> <span class='op'>&lt;-</span> <span class='fu'>last_fit</span><span class='op'>(</span><span class='va'>final_rf</span>, <span class='va'>df_split</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["model"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["mtry"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["min_n"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["rmse"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"42","3":"3","4":"0.0002960400"},{"1":"2","2":"76","3":"6","4":"0.0003004483"},{"1":"3","2":"58","3":"6","4":"0.0003007966"},{"1":"4","2":"46","3":"9","4":"0.0003074919"},{"1":"5","2":"87","3":"12","4":"0.0003140362"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<p>This time-consuming process produces the above results for the top five models. We see overall better results with a smaller number of variables considered at each split, and a smaller number of observations per split - deeper trees.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Finally, we run the best model on the test set and plot the predictions vs. the actual market shares.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf_plot</span> <span class='op'>&lt;-</span> <span class='co'>#Plot of predictions vs truth</span>
  <span class='fu'>collect_predictions</span><span class='op'>(</span><span class='va'>rf_fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>share</span>, <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span>lty <span class='op'>=</span> <span class='fl'>2</span>, color <span class='op'>=</span> <span class='st'>"gray50"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.5</span>, color <span class='op'>=</span> <span class='st'>"midnightblue"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>coord_fixed</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>rf_plot</span>
</code></pre>
</div>
<p><img src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/RF_plot_pred_and_vip-1.png" width="624" data-distill-preview=1 /></p>
</div>
<p>These are quite stunning results, compared to the previous models. The random forest demonstrates quite low bias and low variance.</p>
<p>Let’s have a look at what variables are producing this impressive predictive accuracy by plotting the variable importances:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf_prep</span><span class='op'>&lt;-</span> <span class='fu'>prep</span><span class='op'>(</span><span class='va'>rf_recipe</span><span class='op'>)</span>

<span class='va'>rf_final</span><span class='op'>&lt;-</span> <span class='va'>final_rf</span> <span class='op'>%&gt;%</span> <span class='fu'>pull_workflow_spec</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>rf_vip</span><span class='op'>&lt;-</span> <span class='va'>rf_final</span> <span class='op'>%&gt;%</span>
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"ranger"</span>, importance<span class='op'>=</span><span class='st'>"permutation"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>fit</span><span class='op'>(</span><span class='va'>share</span> <span class='op'>~</span> <span class='va'>.</span>, data<span class='op'>=</span><span class='fu'>juice</span><span class='op'>(</span><span class='va'>rf_prep</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>Year</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>vip</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>rf_vip</span>
</code></pre>
</div>
<p><img src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-15-1.png" width="624" /></p>
</div>
<p>We see many of the same variables as before, with some exceptions. Note the extremely high importance of “company_other”: this variable differentiates models produced by the largest automobile companies from those produced by one of the many smaller companies. It is fairly easy to see why this variable might thus be useful for predicting market share.</p>
<p>Also note the introduction of the “nb_bodystyle” variable, which counts the number of different classes are accounted for in the various trims of a model. If a model has more than one bodystyle represented among its trims, that model is typically a fairly important model for that brand. In other words, the brand has invested considerably in developing variations on that particular model. Thus, it is sensible that this variable would be predictive of market share.</p>
<h1 id="boosting">Boosting</h1>
<p>The final algorithm we will try is a boosted tree, implemented using the xgboost algorithm. Boosting, as opposed to random forest, involves quite a bit of tuning: here, we tune six parameters as listed in the code below.</p>
<!-- XG-Boost -->
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>xgb_recipe</span> <span class='op'>&lt;-</span> 
  <span class='va'>demand_recipe</span> 

<span class='va'>xgb_spec</span> <span class='op'>&lt;-</span> 
  <span class='fu'>boost_tree</span><span class='op'>(</span>trees <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, min_n <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, tree_depth <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, learn_rate <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, 
    loss_reduction <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span>, sample_size <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"xgboost"</span><span class='op'>)</span> 

<span class='va'>xgb_workflow</span> <span class='op'>&lt;-</span> 
  <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>xgb_recipe</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>xgb_spec</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>We tune them using a discrete grid, and examine the results of the top five models.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>82993</span><span class='op'>)</span>

<span class='va'>xgb_tune</span> <span class='op'>&lt;-</span> <span class='fu'>tune_grid</span><span class='op'>(</span><span class='va'>xgb_workflow</span>, resamples <span class='op'>=</span> <span class='va'>df_folds</span>, grid <span class='op'>=</span> <span class='fl'>60</span><span class='op'>)</span>

<span class='fu'>show_best</span><span class='op'>(</span><span class='va'>xgb_tune</span>, metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>

<span class='va'>final_xgb</span> <span class='op'>&lt;-</span> <span class='va'>xgb_workflow</span> <span class='op'>%&gt;%</span>
  <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='fu'>select_best</span><span class='op'>(</span><span class='va'>xgb_tune</span>, metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>xgb_fit</span> <span class='op'>&lt;-</span> <span class='fu'>last_fit</span><span class='op'>(</span><span class='va'>final_xgb</span>, <span class='va'>df_split</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["trees"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["min_n"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["tree_depth"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["learn_rate"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["loss_reduction"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["sample_size"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["rmse"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"1968","2":"36","3":"8","4":"0.006525845","5":"1.135571e-07","6":"0.6979129","7":"0.0003977069"},{"1":"1888","2":"35","3":"12","4":"0.029047411","5":"1.841420e-09","6":"0.2601197","7":"0.0004080520"},{"1":"1462","2":"20","3":"3","4":"0.016690861","5":"9.272890e-10","6":"0.5241768","7":"0.0004119114"},{"1":"1913","2":"17","3":"1","4":"0.048602925","5":"1.223076e-05","6":"0.7418305","7":"0.0005697625"},{"1":"1754","2":"39","3":"2","4":"0.081288367","5":"7.430793e-01","6":"0.5699012","7":"0.0008602943"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<p>There is actually quite significant variability in the performance of these models. We see that the best model involves a quite large number of trees, a fairly large minimum number of observations with a moderate tree depth, low learning rate, moderate loss reduction, and large sample size. It’s a bit difficult to interpret any patterns from these hyperparameters since there are so many of them, but we can at least note the large min_n compared to CART and random forest, suggesting a shallower tree. This is what we’d expect from a boosting algorithm.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Finally, we run the model on the test set and plot its predictive accuracy:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>xgb_plot</span> <span class='op'>&lt;-</span> <span class='co'>#Plot of predictions vs truth</span>
  <span class='fu'>collect_predictions</span><span class='op'>(</span><span class='va'>xgb_fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>share</span>, <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span>lty <span class='op'>=</span> <span class='fl'>2</span>, color <span class='op'>=</span> <span class='st'>"gray50"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.5</span>, color <span class='op'>=</span> <span class='st'>"midnightblue"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>coord_fixed</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>xgb_plot</span>
</code></pre>
</div>
<p><img src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/XGB_plot_pred_and_vip-1.png" width="624" /></p>
</div>
<p>Boosting performs reasonably well - though it is not quite at the level of the random forest. The variance appears to be a bit higher than random forest, while the bias is comparable. Boosting does, however, perform better than both LASSO and CART.</p>
<p>We now plot the variable importances for the boosted model.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>xgb_vip</span> <span class='op'>&lt;-</span> 
  <span class='va'>xgb_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pluck</span><span class='op'>(</span><span class='st'>".workflow"</span>, <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>   
  <span class='fu'>pull_workflow_fit</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>vip</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/vip/man/vip.html'>vip</a></span><span class='op'>(</span>num_features <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>

<span class='va'>xgb_vip</span>
</code></pre>
</div>
<p><img src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-18-1.png" width="624" /></p>
</div>
<p>Again we see somewhat similar results, with Ford, price, and car volume making their usual appearances. We do see the introduction of a couple of new variables, like the pickup truck class and the model age, but overall the results are not extremely different from the other models.</p>
<h2 id="summary-and-conclusion">Summary and Conclusion</h2>
<p>We’ve now fit and tested four different algorithmic models to predict the market shares of automobiles in the United States. Let’s review their overall performances and compare:</p>
<!-- Collect and plot performance metrics of algorithms -->
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>metrics_df</span> <span class='op'>&lt;-</span> 
  <span class='fu'>bind_rows</span><span class='op'>(</span><span class='fu'>collect_metrics</span><span class='op'>(</span><span class='va'>glmnet_fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>algo <span class='op'>=</span> <span class='st'>"LASSO"</span><span class='op'>)</span>,
            <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='va'>cart_fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>algo <span class='op'>=</span> <span class='st'>"CART"</span><span class='op'>)</span>,
            <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='va'>rf_fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>algo <span class='op'>=</span> <span class='st'>"Random Forest"</span><span class='op'>)</span>,
            <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='va'>xgb_fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>mutate</span><span class='op'>(</span>algo <span class='op'>=</span> <span class='st'>"XG Boost"</span><span class='op'>)</span>,
  <span class='op'>)</span>

<span class='va'>metrics_plot</span> <span class='op'>&lt;-</span> 
  <span class='va'>metrics_df</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>algo</span>,<span class='va'>.estimate</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>~</span> <span class='va'>.</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span><span class='op'>)</span>

<span class='va'>metrics_plot</span>
</code></pre>
</div>
<p><img src="jonathan-sheng-algorithmic-demand-estimation-prediction_files/figure-html5/unnamed-chunk-19-1.png" width="624" /></p>
</div>
<p>Clearly, boosting and random forest dominate LASSO and CART in both RMSE and R-squared. We see exceptional performance from random forest, which boasts an R-squared of greater than 0.9. The RMSE for these top two models is about an order of magnitude lower than the average market share. Thus, the predictive portion of this project has been quite successful: we have proven it is possible to use algorithmic models to accurately predict market shares from price, characteristics, and demographic data.</p>
<p>What we have seen in terms of interpretability has been less impressive. Variable importance plots give us some insight into the black boxes of these models, and we’ve learned that certain variables seem to appear again and again: price, Ford, F-series, company dummies. But though price appears in these plots, we don’t have a notion of its effect size, or what the demand elasticity is for these vehicles. Even CART, with its relative ease of interpretability, was hardly readable due to its complexity. Thus, in order to examine inferential questions about demand estimation we will need to try out some different algorithmic techniques in our coming posts, like causal random forests or double machine learning.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
